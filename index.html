<!DOCTYPE html>

<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="var(--dark)" name="theme-color"/>
<title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
<!-- Manifest -->
<link href="manifest.json" rel="manifest"/>
<!-- Favicon -->
<link href="./logo2.jpg" rel="icon" type="image/jpeg"/>
<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root {
    --primary: #f97316;
    --primary-dark: #ea580c;
    --primary-light: #fed7aa;
    --secondary: #059669;
    --secondary-light: #d1fae5;
    --dark: #1f2937;
    --light: #f9fafb;
    --gray: #6b7280;
    --gray-light: #f3f4f6;
    --border: #e5e7eb;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    --info: #3b82f6;
    --waiting: #8b5cf6;
    --sidebar-width: 280px;
    --header-height: 70px;
    --shadow-light: 0 1px 3px rgba(0,0,0,0.1);
    --shadow-medium: 0 4px 6px rgba(0,0,0,0.15);
    --shadow-heavy: 0 10px 25px rgba(0,0,0,0.3);
    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 20px;
}

* {
  box-sizing: border-box;
  transition: all 0.3s ease;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  padding: 20px;
  background-image: 
    linear-gradient(rgba(0,0,0,0.55), rgba(0,0,0,0.55)), 
    url('./images/backraound.jpg');
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  background-attachment: fixed;
  margin: 0;
  direction: rtl;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}

.container {
  max-width: 420px;
  width: 100%;
  padding: 40px;
  border-radius: var(--radius-lg);
  background: rgba(255, 255, 255, 0.12);
  border: 1px solid rgba(255, 255, 255, 0.25);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  box-shadow: var(--shadow-heavy);
  color: #fff;
  animation: fadeInUp 0.8s ease both;
}

@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

h2 {
  text-align: center;
  color: #fff;
  margin-bottom: 25px;
  font-size: 26px;
  font-weight: 700;
  letter-spacing: 1px;
}

label {
  display: block;
  margin: 18px 0 8px;
  font-weight: 600;
  color: #f3f4f6;
  font-size: 14px;
}

.input-group {
  position: relative;
}

.input-group i {
  position: absolute;
  top: 50%;
  left: 14px;
  transform: translateY(-50%);
  color: rgba(255,255,255,0.7);
  pointer-events: none;
}

input {
  width: 100%;
  padding: 14px 40px 14px 14px;
  border: 1px solid rgba(255,255,255,0.3);
  border-radius: var(--radius-md);
  font-size: 15px;
  background: rgba(255, 255, 255, 0.15);
  color: #fff;
}

input::placeholder {
  color: rgba(255,255,255,0.7);
}

input:focus {
  outline: none;
  border-color: var(--primary-light);
  background: rgba(255, 255, 255, 0.25);
  transform: translateY(-2px);
  box-shadow: 0 6px 18px rgba(0, 0, 0, 0.3), 0 0 12px var(--primary-light);
}

button {
  margin-top: 28px;
  padding: 14px;
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  color: #fff;
  border: none;
  border-radius: var(--radius-md);
  cursor: pointer;
  width: 100%;
  font-size: 16px;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 1px;
  box-shadow: 0 4px 15px rgba(249, 115, 22, 0.4);
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 28px rgba(0, 0, 0, 0.4), 0 0 20px var(--primary-light);
}

button:active {
  transform: translateY(0);
}

#status, #regStatus, #resetStatus, #changeEmailStatus {
  margin-top: 20px;
  padding: 14px;
  border-radius: var(--radius-md);
  text-align: center;
  font-weight: bold;
  font-size: 14px;
}

.success { 
  background: linear-gradient(135deg, var(--success) 0%, var(--secondary-light) 100%); 
  color: white; 
}

.error { 
  background: linear-gradient(135deg, var(--danger) 0%, var(--danger) 100%); 
  color: white; 
}

.info { 
  background: linear-gradient(135deg, var(--info) 0%, var(--info) 100%); 
  color: white; 
}

.loader {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255,255,255,0.3);
  border-radius: 50%;
  border-top-color: white;
  animation: spin 1s ease-in-out infinite;
  margin-left: 10px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.register-link {
  text-align: center;
  margin-top: 20px;
  padding: 15px;
  background: rgba(255,255,255,0.08);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-light);
}

.register-link a {
  color: var(--primary-light);
  text-decoration: none;
  font-weight: 600;
  transition: all 0.3s ease;
  display: block;
  margin: 5px 0;
}

.register-link a:hover {
  color: #fff;
  text-decoration: underline;
}

.install-btn {
  position: fixed;
  bottom: 20px;
  right: 20px;
  padding: 10px 20px;
  background: var(--dark);
  color: #fff;
  border: none;
  border-radius: var(--radius-sm);
  cursor: pointer;
  z-index: 10000;
  box-shadow: var(--shadow-heavy);
}

@media (max-width: 500px) {
  .container {
    padding: 25px;
  }
  h2 {
    font-size: 22px;
  }
  input, button {
    font-size: 14px;
    padding: 12px;
  }
}
</style>
</head>
<body>
<div class="container">
<img alt="Logo" src="./logo2.jpg" style="display:block; margin:0 auto 15px;     width: 100px;
    height: 100px; border-radius:50%; box-shadow: var(--shadow-medium);"/><h2> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
<form id="loginForm">
<label>ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:
        <input autocomplete="email" id="email" placeholder="Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required="" type="email"/>
</label>
<label>ğŸ”’ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:
        <input autocomplete="current-password" id="password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required="" type="password"/>
</label>
<button type="submit">Ø¯Ø®ÙˆÙ„</button>
</form>
<p id="status"></p>
<div class="register-link">
<a href="#" onclick="showRegisterForm()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</a>
<a href="#" onclick="showResetPasswordForm()">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</a>
<a href="#" onclick="showChangeEmailForm()">ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</a>
</div>
</div>
<!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
<div id="registerContainer" style="display: none;">
<div class="container">
<h2>ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</h2>
<form id="registerForm">
<label>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:
          <input id="regFullName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„" required="" type="text"/>
</label>
<label>ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:
          <input id="regEmail" placeholder="Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required="" type="email"/>
</label>
<label>ğŸ”’ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:
          <input id="regPassword" minlength="6" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ©" required="" type="password"/>
</label>
<label>ğŸ‘” Ø§Ù„Ø¯ÙˆØ±:
          <select id="regRole" style="padding: 15px; border: 2px solid var(--border); border-radius: 10px; font-size: 16px; background: var(--light);">
<option value="admin">Ù…Ø´Ø±Ù</option>
<option value="teacher">Ù…Ø¹Ù„Ù…</option>
<option value="secretary">Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ (Ø§Ù„Ø³ÙŠÙƒØ±ØªÙŠØ±)</option>
</select>
</label>
<button type="submit">ØªØ³Ø¬ÙŠÙ„</button>
</form>
<p id="regStatus"></p>
<div class="register-link">
<a href="#" onclick="showLoginForm()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
</div>
</div>
</div>
<!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
<div id="resetPasswordContainer" style="display: none;">
<div class="container">
<h2>ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h2>
<form id="resetPasswordForm">
<label>ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:
          <input id="resetEmail" placeholder="Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required="" type="email"/>
</label>
<button type="submit">Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†</button>
</form>
<p id="resetStatus"></p>
<div class="register-link">
<a href="#" onclick="showLoginForm()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
</div>
</div>
</div>
<!-- Ù†Ù…ÙˆØ°Ø¬ ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ -->
<div id="changeEmailContainer" style="display: none;">
<div class="container">
<h2>âœ‰ï¸ ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</h2>
<div id="changeEmailFormContainer">
<form id="changeEmailForm">
<label>ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ:
            <input id="currentEmail" placeholder="Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ" readonly="" required="" type="email"/>
</label>
<label>ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯:
            <input id="newEmail" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯" required="" type="email"/>
</label>
<button type="submit">Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ£ÙƒÙŠØ¯</button>
</form>
</div>
<p id="changeEmailStatus"></p>
<div class="register-link">
<a href="#" onclick="showLoginForm()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
</div>
</div>
</div>
<script>
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„
    const supabaseClient = supabase.createClient(
      "https://zefsmckaihzfiqqbdake.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InplZnNtY2thaWh6ZmlxcWJkYWtlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQyMzUzNTgsImV4cCI6MjA2OTgxMTM1OH0.vktk2VkEPtMclb6jb_pFa1DbrqWX9SOZRsBR577o5mc"
    );

    // Ù…ØªØºÙŠØ±Ø§Øª Ù„Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© (Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† localStorage)
    let currentUser = null;
    let signupEmail = null;

    // Ø¹Ø±Ø¶ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
    function showRegisterForm() {
      document.querySelector('.container').style.display = 'none';
      document.getElementById('registerContainer').style.display = 'block';
      document.getElementById('resetPasswordContainer').style.display = 'none';
      document.getElementById('changeEmailContainer').style.display = 'none';
    }

    // Ø¹Ø±Ø¶ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
    function showResetPasswordForm() {
      document.querySelector('.container').style.display = 'none';
      document.getElementById('registerContainer').style.display = 'none';
      document.getElementById('resetPasswordContainer').style.display = 'block';
      document.getElementById('changeEmailContainer').style.display = 'none';
    }

    // Ø¹Ø±Ø¶ Ù†Ù…ÙˆØ°Ø¬ ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
    function showChangeEmailForm() {
      document.querySelector('.container').style.display = 'none';
      document.getElementById('registerContainer').style.display = 'none';
      document.getElementById('resetPasswordContainer').style.display = 'none';
      document.getElementById('changeEmailContainer').style.display = 'block';
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙ…Ù„Ø¡ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ
      checkUserAndFillEmail();
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙ…Ù„Ø¡ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ
    async function checkUserAndFillEmail() {
      try {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ù„Ø³Ø© Ø£ÙˆÙ„Ø§Ù‹
        const { data: { session }, error: sessionError } = await supabaseClient.auth.getSession();
        
        if (sessionError) {
          throw sessionError;
        }
        
        if (!session || !session.user) {
          document.getElementById('changeEmailFormContainer').style.display = 'none';
          document.getElementById('changeEmailStatus').className = 'error';
          document.getElementById('changeEmailStatus').textContent = 'âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ.';
          return;
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        const { data: { user }, error: userError } = await supabaseClient.auth.getUser();
        
        if (userError) {
          throw userError;
        }
        
        if (user && user.email) {
          document.getElementById('currentEmail').value = user.email;
          document.getElementById('changeEmailFormContainer').style.display = 'block';
          document.getElementById('changeEmailStatus').className = 'info';
          document.getElementById('changeEmailStatus').textContent = 'âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø­Ø³Ø§Ø¨Ùƒ. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ.';
        } else {
          document.getElementById('changeEmailFormContainer').style.display = 'none';
          document.getElementById('changeEmailStatus').className = 'error';
          document.getElementById('changeEmailStatus').textContent = 'âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ.';
        }
      } catch (error) {
        console.error('Error checking user:', error);
        document.getElementById('changeEmailFormContainer').style.display = 'none';
        document.getElementById('changeEmailStatus').className = 'error';
        document.getElementById('changeEmailStatus').textContent = 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨: ' + error.message;
      }
    }

    // Ø¹Ø±Ø¶ Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    function showLoginForm() {
      document.getElementById('registerContainer').style.display = 'none';
      document.getElementById('resetPasswordContainer').style.display = 'none';
      document.getElementById('changeEmailContainer').style.display = 'none';
      document.querySelector('.container').style.display = 'block';
    }

    // Ù…Ø¹Ø§Ù„Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const status = document.getElementById('status');
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      status.textContent = '';
      status.className = 'info';
      status.innerHTML = '<span class="loader"></span> Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...';

      try {
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        const { data, error } = await supabaseClient.auth.signInWithPassword({
          email,
          password
        });

        if (error) {
          status.className = 'error';
          status.textContent = 'ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„: ' + error.message;
          return;
        }

        if (!data.user) {
          status.className = 'error';
          status.textContent = 'Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….';
          return;
        }

        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† user_metadata Ø£ÙˆÙ„Ø§Ù‹
        let full_name = data.user.user_metadata?.full_name;
        let role = data.user.user_metadata?.role;

        // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ user_metadataØŒ Ù†Ø­Ø§ÙˆÙ„ Ø¬Ù„Ø¨Ù‡Ø§ Ù…Ù† Ø¬Ø¯ÙˆÙ„ users
        if (!full_name || !role) {
          console.log('Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø¬Ø¯ÙˆÙ„ users...');
          const { data: userData, error: userError } = await supabaseClient
            .from('users')
            .select('full_name, role')
            .eq('id', data.user.id)
            .maybeSingle();

          if (userError) {
            console.error('Database error:', userError);
            status.className = 'error';
            status.textContent = 'Ø®Ø·Ø£ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + userError.message;
            return;
          }

          if (userData) {
            full_name = userData.full_name;
            role = userData.role;
          }
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
        if (!full_name || !role) {
          status.className = 'error';
          status.textContent = 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙƒØ§Ù…Ù„Ø©. Ø§Ù„Ø§Ø³Ù…: ' + (full_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯') + 'ØŒ Ø§Ù„Ø¯ÙˆØ±: ' + (role || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯');
          return;
        }
        currentUser = { ...data.user, full_name, role };

        status.className = 'success';

        if (role === 'admin') {
          status.textContent = `ğŸ‰ Ù…Ø±Ø­Ø¨Ø§Ù‹ ${full_name}! ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù...`;
          setTimeout(() => {
            alert('Ø³ÙŠØªÙ… ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù');
            window.location.href = 'admin-dashboard.html';
          }, 1500);
        } else if (role === 'teacher') {
          status.textContent = `ğŸ‰ Ù…Ø±Ø­Ø¨Ø§Ù‹ ${full_name}! ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù…...`;
          setTimeout(() => {
            alert('Ø³ÙŠØªÙ… ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù…');
            window.location.href = 'dashboard-teacher.html';
          }, 1500);
        } else if (role === 'secretary') {
          status.textContent = `ğŸ‰ Ù…Ø±Ø­Ø¨Ø§Ù‹ ${full_name}! ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨...`;
          setTimeout(() => {
            window.location.href = 'dashboard-secretary.html';
          }, 1500);
        } else {
          status.className = 'error';
          status.textContent = 'Ø¯ÙˆØ± ØºÙŠØ± Ù…Ø´Ù‡ÙˆØ±: ' + role;
        }

      } catch (err) {
        console.error('Unexpected error:', err);
        status.className = 'error';
        status.textContent = 'Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: ' + err.message;
      }
    });

// check if user came from supabase auth link
window.addEventListener("load", () => {
  const params = new URLSearchParams(window.location.hash.substring(1));
  if (params.has("access_token")) {
    // âœ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ù…Ø´Ø±ÙˆØ¹
    window.location.href = "https://apdla-coder.github.io/Assiut-Academy/?" + window.location.hash.substring(1);
  }
});


// Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯
document.getElementById('registerForm').addEventListener('submit', async function(e) {
  e.preventDefault();

  const status = document.getElementById('regStatus');
  status.textContent = '';
  status.className = '';

  const fullName = document.getElementById('regFullName').value;
  const email = document.getElementById('regEmail').value;
  const password = document.getElementById('regPassword').value;
  const role = document.getElementById('regRole').value;

  status.className = 'info';
  status.innerHTML = '<span class="loader"></span> Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨...';

  try {
    // âœ… ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (6)
    const { count, error: countError } = await supabaseClient
      .from('users')
      .select('id', { count: 'exact', head: true });

    if (countError) {
      status.textContent = 'âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†: ' + countError.message;
      status.className = 'error';
      return;
    }

    if (count >= 6) {
      status.textContent = 'ğŸš« ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ (6 Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†). Ø¨Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø´Ø±Ù Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯.';
      status.className = 'error';
      return;
    }

    // âœ… ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯ Ù‚Ø¨Ù„ ÙƒØ¯Ù‡
    const { data: existingUser, error: checkError } = await supabaseClient
      .from('users')
      .select('email')
      .eq('email', email)
      .maybeSingle();

    if (checkError) {
      status.textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: ' + checkError.message;
      status.className = 'error';
      return;
    }

    if (existingUser) {
      status.textContent = 'âŒ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹.';
      status.className = 'error';
      return;
    }

// Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨
const { data, error } = await supabaseClient.auth.signUp({
  email,
  password,
  options: {
    emailRedirectTo: 'https://apdla-coder.github.io/Assiut-Academy/',
    data: {
      full_name: fullName,
      role: role
    }
  }
});


    if (error) {
      console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„:", error.message);
      status.className = 'error';
      status.textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ' + error.message;
      return;
    }

    console.log("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:", data.user);

    if (data && data.user) {
      status.textContent = 'âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨Ùƒ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø±Ø³Ù„ Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ.';
      status.className = 'success';
      setTimeout(() => {
        showLoginForm();
      }, 3000);
    } else {
      status.textContent = 'ğŸ“¬ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ.';
      status.className = 'success';
      setTimeout(() => {
        showLoginForm();
      }, 2000);
    }

  } catch (err) {
    status.textContent = 'âŒ Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: ' + err.message;
    status.className = 'error';
    console.error("Unexpected error:", err);
  }
});


    // Ù…Ø¹Ø§Ù„Ø¬ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
    document.getElementById('resetPasswordForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const status = document.getElementById('resetStatus');
      const email = document.getElementById('resetEmail').value;

      status.textContent = '';
      status.className = 'info';
      status.innerHTML = '<span class="loader"></span> Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø§Ø¨Ø·...';

      try {
        const { error } = await supabaseClient.auth.resetPasswordForEmail(email, {
          redirectTo: 'https://apdla-coder.github.io/Assiut-Academy/update-password.html'
        });

        if (error) throw error;

        status.className = 'success';
        status.textContent = 'ğŸ“¬ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ.';
      } catch (err) {
        status.className = 'error';
        status.textContent = 'âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: ' + err.message;
      }
    });

    // Ù…Ø¹Ø§Ù„Ø¬ ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
    document.getElementById('changeEmailForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const status = document.getElementById('changeEmailStatus');
      const currentEmail = document.getElementById('currentEmail').value;
      const newEmail = document.getElementById('newEmail').value;

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù…Ø®ØªÙ„Ù Ø¹Ù† Ø§Ù„Ø­Ø§Ù„ÙŠ
      if (currentEmail === newEmail) {
        status.className = 'error';
        status.textContent = 'âŒ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù…Ø®ØªÙ„ÙÙ‹Ø§ Ø¹Ù† Ø§Ù„Ø­Ø§Ù„ÙŠ';
        return;
      }

      status.textContent = '';
      status.className = 'info';
      status.innerHTML = '<span class="loader"></span> Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ£ÙƒÙŠØ¯...';

      try {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„
        const { data: { session }, error: sessionError } = await supabaseClient.auth.getSession();
        
        if (sessionError) {
          throw sessionError;
        }
        
        if (!session || !session.user) {
          status.className = 'error';
          status.textContent = 'âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹';
          return;
        }

        const { data: { user }, error: userError } = await supabaseClient.auth.getUser();
        
        if (userError) {
          throw userError;
        }
        
        if (!user) {
          status.className = 'error';
          status.textContent = 'âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹';
          return;
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ ØµØ­ÙŠØ­
        if (user.email !== currentEmail) {
          status.className = 'error';
          status.textContent = 'âŒ Ù‡Ù†Ø§Ùƒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ';
          return;
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯
        const { error } = await supabaseClient.auth.updateUser({ email: newEmail });

        if (error) throw error;

        status.className = 'success';
        status.textContent = 'ğŸ“¬ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨Ø±ÙŠØ¯Ùƒ ÙˆØ§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ù„ØªØ£ÙƒÙŠØ¯.';

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø¹Ø¯ Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
        setTimeout(() => {
          document.getElementById('newEmail').value = '';
        }, 3000);

      } catch (err) {
        status.className = 'error';
        status.textContent = 'âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: ' + err.message;
      }
    });

    // ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    window.addEventListener('load', async () => {
      try {
        const { data: { session }, error } = await supabaseClient.auth.getSession();
        if (session && !error) {
          console.log('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ù…Ø³Ø¨Ù‚Ø§Ù‹:', session.user);
          currentUser = session.user;
        }
      } catch (err) {
        console.error('Error checking session:', err);
      }
    });
  </script>
<!-- ØªØ³Ø¬ÙŠÙ„ Service Worker + Ø²Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª -->
<script>
    // Ø³Ø¬Ù„ SW Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© (Ø§Ù„Ù…Ù„Ù: sw.js)
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js')
        .then(reg => console.log('âœ… Service Worker Registered', reg.scope))
        .catch(err => console.error('âŒ Service Worker Error:', err));
    }

    // Ù‚Ø¨Ù„ Ø­Ø¯Ø« Ø§Ù„ØªØ«Ø¨ÙŠØª: Ø§Ø¹Ø±Ø¶ Ø²Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;

      const installBtn = document.createElement('button');
      installBtn.className = 'install-btn';
      installBtn.textContent = 'ğŸ“² ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚';
      document.body.appendChild(installBtn);

      installBtn.addEventListener('click', async () => {
        installBtn.disabled = true;
        deferredPrompt.prompt();
        const choiceResult = await deferredPrompt.userChoice;
        if (choiceResult.outcome === 'accepted') {
          console.log('ØªÙ… Ø§Ù„ØªØ«Ø¨ÙŠØª Ø¨Ù†Ø¬Ø§Ø­');
        } else {
          console.log('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ«Ø¨ÙŠØª');
        }
        deferredPrompt = null;
        installBtn.remove();
      });
    });

    // optional: ØªØ­ÙƒÙ‘Ù… ÙÙŠ Ø­Ø¯Ø« Ø§Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„ÙØ¹Ù„ÙŠ (Ø¨Ø¹Ø¯ Ø§Ù„ØªØ«Ø¨ÙŠØª)
    window.addEventListener('appinstalled', () => {
      console.log('App installed');
    });

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø£Ùˆ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
      const installBtn = document.createElement('button');
      installBtn.innerText = 'ğŸ“² Ø«Ø¨Ù‘Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚';
      installBtn.style.position = 'fixed';
      installBtn.style.bottom = '20px';
      installBtn.style.right = '20px';
      installBtn.style.padding = '10px 20px';
      installBtn.style.zIndex = '9999';
      
      document.body.appendChild(installBtn);
      
      installBtn.addEventListener('click', async () => {
        installBtn.remove();
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        console.log(`User response to install: ${outcome}`);
        deferredPrompt = null;
      });
    });

    // Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ù† Ø§Ù„Ù€ Service Worker
    navigator.serviceWorker.addEventListener('message', (evt) => {
      const msg = evt.data;
      if (!msg) return;

      if (msg.type === 'SW_UPDATED') {
        // Ù‡Ù†Ø§ ØªØ¹Ø±Ø¶ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†Ø§ÙØ°Ø©/ØªÙˆØ³Øª ØªØ®Ø¨Ø±Ù‡ Ø£Ù† Ù‡Ù†Ø§Ùƒ ØªØ­Ø¯ÙŠØ«
        // Ù…Ø«Ø§Ù„ Ø¨Ø³ÙŠØ·: Ø§Ù†Ø´Ø¦ Ø²Ø± ÙÙˆØ±Ù‘ÙŠ Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        const updateBar = document.createElement('div');
        updateBar.style.position = 'fixed';
        updateBar.style.left = '0';
        updateBar.style.right = '0';
        updateBar.style.bottom = '0';
        updateBar.style.padding = '12px';
        updateBar.style.background = 'var(--dark)';
        updateBar.style.color = '#fff';
        updateBar.style.textAlign = 'center';
        updateBar.style.zIndex = '10000';
        updateBar.textContent = 'ÙŠÙˆØ¬Ø¯ ØªØ­Ø¯ÙŠØ« Ù…ØªØ§Ø­ â€” Ø§Ø¶ØºØ· Ù„Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù†';
        updateBar.style.cursor = 'pointer';
        document.body.appendChild(updateBar);

        updateBar.addEventListener('click', async () => {
          // Ø§Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ù€ SW ØªÙØ¹ÙŠÙ„ Ù†ÙØ³Ù‡ ÙÙˆØ±Ø§Ù‹ØŒ Ø«Ù… Ø£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
          const registration = await navigator.serviceWorker.getRegistration();
          if (registration && registration.waiting) {
            // Ø£Ø®Ø¨Ø± Ø§Ù„Ù€ SW Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø£Ù†Ù‡ ÙŠØ±ØºØ¨ ÙÙŠ Ø§Ù„ØªÙØ¹ÙŠÙ„ ÙÙˆØ±Ø§Ù‹
            registration.waiting.postMessage({ type: 'SKIP_WAITING' });
          }
          // Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø«Ù… Ø£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„ØªØ³ØªØ®Ø¯Ù… Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
          setTimeout(() => location.reload(true), 500);
        });

        // Ø§Ø®ØªÙØ§Ø¡ Ø§Ù„Ø²Ø± Ø¨Ø¹Ø¯ 20 Ø«Ø§Ù†ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        setTimeout(() => {
          updateBar.remove();
        }, 20000);
      }
    });
  </script>
</body>
</html>