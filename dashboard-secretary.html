    <!DOCTYPE html>
    <html lang="ar" dir="rtl">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ููุญุฉ ุงูุชุญูู - ุงูุณูุฑุชูุฑ</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <link rel="stylesheet" href="./cs/secretary.css">

    <link rel="icon" href="/images/logo2.jpg" type="image/jpeg">



    </head>
    <body>

    <!-- Sidebar -->
    <div class="sidebar" id="appSidebar">
            <div class="sidebar-header">
            <img class="logo" src="./logo2.jpg" alt="">
                <h3> Assiut Academy </h3>
            </div>
            <ul class="sidebar-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" onclick="switchTab('dashboard'); setActiveLink(this);">
                        <i class="fas fa-home"></i>
                        <span>ุงูุฑุฆูุณูุฉ</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="switchTab('students'); setActiveLink(this);">
                        <i class="fas fa-users"></i>
                        <span>ุงูุทูุงุจ</span>
                    </a>
                </li>
                <li class="nav-item">
        <a href="#" class="nav-link" onclick="switchTab('parents'); setActiveLink(this);">
            <i class="fas fa-user-friends"></i> <!-- Icon for Parents -->
            <span>ุฃูููุงุก ุงูุฃููุฑ</span>
        </a>
    </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="switchTab('courses'); setActiveLink(this);">
                        <i class="fas fa-book"></i>
                        <span>ุงูููุฑุณุงุช</span>
                    </a>
                </li>
                <li class="nav-item">
        <a href="#" class="nav-link" onclick="switchTab('teacherExams'); setActiveLink(this);">
            <i class="fas fa-file-alt"></i>
            <span>ุงุฎุชุจุงุฑุงุช ุงููุนูููู</span>
        </a>
    </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="switchTab('subscriptions'); setActiveLink(this);">
                        <i class="fas fa-file-contract"></i>
                        <span>ุงูุงุดุชุฑุงูุงุช</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="switchTab('payments'); setActiveLink(this);">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>ุงููุฏููุนุงุช</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="switchTab('attendances'); setActiveLink(this);">
                        <i class="fas fa-calendar-check"></i>
                        <span>ุงูุญุถูุฑ</span>
                    </a>
                </li>
    <li class="nav-item">
    <a class="nav-link" href="#" onclick="switchTab('dataManagement')">ุฅุฏุงุฑุฉ ุงูุจูุงูุงุช</a>
    </li>
                
            </ul>
    </div>

    <!-- Overlay for mobile when sidebar is open -->
    <div class="overlay" id="sidebarOverlay" aria-hidden="true"></div>

    <!-- Main Content -->
    <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div class="header-title">
                    <h1>ููุญุฉ ุงูุชุญูู</h1>
                </div>
                <button id="menuToggle" type="button" class="menu-toggle-btn">
    <i class="fas fa-bars"></i>
    </button>

                <div class="user-info">
                    <span id="userName">ุงูุณูุฑุชูุฑ</span>
                    <i class="fas fa-user-circle fa-2x"></i>
                </div>
            </div>

    <!-- secretary attendance UI moved into Attendances tab (mobile-friendly) -->


            <!-- Content -->
            <div class="content">
                <!-- Dashboard Tab -->
                <div id="dashboardContent" class="tab-content" style="display: block;">
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-icon bg-primary">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-text">
                                <h3 id="totalStudents">0</h3>
                                <p>ุนุฏุฏ ุงูุทูุงุจ</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon bg-success">
                                <i class="fas fa-book"></i>
                            </div>
                            <div class="stat-text">
                                <h3 id="totalCourses">0</h3>
                                <p>ุนุฏุฏ ุงูููุฑุณุงุช</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon bg-warning">
                                <i class="fas fa-file-contract"></i>
                            </div>
                            <div class="stat-text">
                                <h3 id="totalSubscriptions">0</h3>
                                <p>ุนุฏุฏ ุงูุงุดุชุฑุงูุงุช</p>
                            </div>
                        </div>
    <div class="stat-card">
        <div class="stat-icon bg-info">
            <i class="fas fa-user-check"></i>
        </div>
        <div class="stat-text">
            <h3 id="totalRevenue">0</h3>
            <p>ุนุฏุฏ ุงูุญุงุถุฑูู ุงูููู</p>
        </div>
    </div>
                    </div>

                    <div class="charts">
                        <div class="chart-container">
                            <h2>ุงูุฅูุฑุงุฏุงุช ุงูุดูุฑูุฉ</h2>
                            <canvas id="revenueChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <h2>ุชูุฒูุน ุงูุทูุงุจ ุญุณุจ ุงูููุฑุณุงุช</h2>
                            <canvas id="studentsChart"></canvas>
                        </div>
                    </div>

                    <div class="recent-activity">
                        <h2>ุขุฎุฑ ุงูุฃูุดุทุฉ</h2>
                        <ul class="activity-list" id="activityList">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                <p>ุฌุงุฑู ุชุญููู ุขุฎุฑ ุงูุฃูุดุทุฉ...</p>
                            </div>
                        </ul>
                    </div>
                </div>


    <div id="dataManagementContent" class="tab-content data-management" style="display:none;">
    <div class="section-header">
    <h2>ุฅุฏุงุฑุฉ ุงูุจูุงูุงุช</h2>
    <p>ูุชุงุจุนุฉ ุญุฌู ุงูุจูุงูุงุช ูุนุฏุฏ ุงูุตููู ูุน ูุคุดุฑุงุช ุงุณุชุฎุฏุงู.</p>
    </div>
    <div id="summaryStats" class="summary-grid"></div>
    <div id="statsContainer" class="stats-grid"></div>
    </div>


                <!-- Students Tab -->
                <div id="studentsContent" class="tab-content" style="display: none;">
                    <div class="search-filter">
                        <div class="search-box">
                            <input type="text" id="studentSearch" placeholder="ุจุญุซ ุนู ุทุงูุจ..." onkeyup="filterStudents()">
                        </div>
                    </div>
                    <div id="studentsContainer">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <p>ุฌุงุฑู ุชุญููู ุจูุงูุงุช ุงูุทูุงุจ...</p>
                        </div>
                    </div>
                </div>

    <!-- Parents Tab -->
    <div id="parentsContent" class="tab-content" style="display: none;">
            <h2 style="margin-bottom: 20px; color: var(--primary, #f97316); font-weight: 700; font-size: 1.6rem; text-align: center;">ุฅุฑุณุงู ุชูุฑูุฑ ููุทูุงุจ ุนุจุฑ ุงููุงุชุณุงุจ</h2>
        <div class="search-filter">
            <div class="search-box">
                <input type="text" id="parentSearch" placeholder="ุจุญุซ ุนู ุทุงูุจ..." onkeyup="filterParents()">
            </div>
        </div>
        <div id="parentsStudentsContainer">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>ุฌุงุฑู ุชุญููู ุจูุงูุงุช ุงูุทูุงุจ...</p>
            </div>
        </div>
    </div>

    <!-- Courses Tab -->
    <div id="coursesContent" class="tab-content" style="display: none;">
        <div class="search-filter">
            <div class="search-box">
                <input type="text" id="courseSearch" placeholder="ุจุญุซ ุนู ููุฑุณ..." onkeyup="filterCourses()">
            </div>
        </div>
        <div id="coursesContainer">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>ุฌุงุฑู ุชุญููู ุจูุงูุงุช ุงูููุฑุณุงุช...</p>
            </div>
        </div>
    </div>

    <div id="teacherExamsContent" class="tab-content" style="display:none;">
    <h2 style="margin-bottom: 20px; color: var(--primary, #f97316); font-weight: 700; font-size: 1.6rem; text-align: center;">๐ ูุงุฆูุฉ ุงุฎุชุจุงุฑุงุช ุงููุนูููู</h2>  <input type="text" id="teacherExamSearch" placeholder="๐ ุงุจุญุซ ุจุงุณู ุงูุงุฎุชุจุงุฑ ุฃู ุงูููุฑุณ" style="padding:8px; margin-bottom:15px; width:100%; max-width:300px;">
    <div id="teacherExamsContainer"></div>
    </div>
    <!-- Course Detail Modal (ููุนุฑุถ ุนูุฏ ุงูููุฑ ุนูู ููุฑุณ) -->
    <div id="courseDetailModal" class="modal">
        <div class="modal-content modal-lg"> <!-- ุงุณุชุฎุฏู modal-lg ููุนุฑุถ ุงูุฃูุจุฑ -->
            <div class="modal-header">
                <h2 id="courseDetailTitle">ุชูุงุตูู ุงูููุฑุณ</h2>
                <button class="close" onclick="closeModal('courseDetailModal')">&times;</button>
            </div>
            <div class="modal-body">
                <!-- ุนูุงูุงุช ุงูุชุจููุจ ุฏุงุฎู ูุงูุฐุฉ ุชูุงุตูู ุงูููุฑุณ -->
                <div class="course-detail-tabs">
                    <button class="tab-button active" onclick="switchCourseDetailTab('overview')">ูุธุฑุฉ ุนุงูุฉ</button>
                    <button class="tab-button" onclick="switchCourseDetailTab('modules')">ุงููุญุฏุงุช ูุงูุฏุฑูุณ</button>
                    <!-- ููููู ุฅุถุงูุฉ ุนูุงูุงุช ุชุจููุจ ุฃุฎุฑู ุญุณุจ ุงูุญุงุฌุฉ -->
                </div>

                <!-- ูุญุชูู ุชุจููุจ "ูุธุฑุฉ ุนุงูุฉ" -->
                <div id="courseOverviewTab" class="course-detail-tab-content">
                    <div class="course-detail-info">
                        <p><strong>ุงูุงุณู:</strong> <span id="detailCourseName"></span></p>
                        <p><strong>ุงููุตู:</strong> <span id="detailCourseDescription"></span></p>
                        <p><strong>ุงูุณุนุฑ:</strong> <span id="detailCoursePrice"></span> ุฌ.ู</p>
                        <p><strong>ุงููุนูู ุงููุณุคูู:</strong> <span id="detailCourseTeacher"></span></p>
                        <p><strong>ุชุงุฑูุฎ ุงูุจุฏุงูุฉ:</strong> <span id="detailCourseStartDate"></span></p>
                        <p><strong>ุชุงุฑูุฎ ุงูููุงูุฉ:</strong> <span id="detailCourseEndDate"></span></p>
                    </div>
                    <div class="modal-footer" style="margin-top: 20px;">
                        <button class="btn btn-secondary" onclick="showEditCourseModal(getCurrentCourseIdFromDetail())">ุชุนุฏูู</button>
                        <button class="btn btn-danger" onclick="deleteCourse(getCurrentCourseIdFromDetail())">ุญุฐู</button>
                        <button class="btn btn-outline" onclick="closeModal('courseDetailModal')">ุฅุบูุงู</button>
                    </div>
                </div>

                <!-- ูุญุชูู ุชุจููุจ "ุงููุญุฏุงุช ูุงูุฏุฑูุณ" -->
                <div id="courseModulesTab" class="course-detail-tab-content" style="display:none;">
                    <div class="modules-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3>ุงููุญุฏุงุช</h3>
                            <button class="btn btn-primary" onclick="openAddModuleModal()">ุฅุถุงูุฉ ูุญุฏุฉ</button>
                        </div>
                        <div id="modulesList">
                            <!-- ุณูุชู ุชุนุจุฆุฉ ุงููุงุฆูุฉ ุจูุงุณุทุฉ JavaScript -->
                            <p class="no-data">ุฌุงุฑู ุชุญููู ุงููุญุฏุงุช...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal ุฅุถุงูุฉ/ุชุนุฏูู ูุญุฏุฉ -->
    <div id="moduleModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('moduleModal')">&times;</span>
            <h2 id="moduleModalTitle">ุฅุถุงูุฉ ูุญุฏุฉ ุฌุฏูุฏุฉ</h2>
            <form id="moduleForm">
                <input type="hidden" id="moduleId">
                <div class="form-group">
                    <label for="moduleTitle">ุงุณู ุงููุญุฏุฉ:</label>
                    <input type="text" id="moduleTitle" required>
                </div>
                <div class="form-group">
                    <label for="moduleDescription">ูุตู ุงููุญุฏุฉ:</label>
                    <textarea id="moduleDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="moduleOrder">ุชุฑุชูุจ ุงููุญุฏุฉ:</label>
                    <input type="number" id="moduleOrder" min="1">
                </div>
                <button type="submit" class="btn btn-primary">ุญูุธ</button>
            </form>
        </div>
    </div>

    <!-- Modal ุฅุถุงูุฉ/ุชุนุฏูู ุฏุฑุณ -->
    <div id="lessonModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('lessonModal')">&times;</span>
            <h2 id="lessonModalTitle">ุฅุถุงูุฉ ุฏุฑุณ ุฌุฏูุฏ</h2>
            <form id="lessonForm">
                <input type="hidden" id="lessonId">
                <input type="hidden" id="lessonModuleId"> <!-- ูุชุฎุฒูู module_id -->
                <div class="form-group">
                    <label for="lessonTitle">ุนููุงู ุงูุฏุฑุณ:</label>
                    <input type="text" id="lessonTitle" required>
                </div>
                <div class="form-group">
                    <label for="lessonDescription">ูุตู ุงูุฏุฑุณ:</label>
                    <textarea id="lessonDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="lessonDate">ุชุงุฑูุฎ ุงูุฏุฑุณ:</label>
                    <input type="date" id="lessonDate">
                </div>
                <button type="submit" class="btn btn-primary">ุญูุธ</button>
            </form>
        </div>
    </div>
                <!-- Subscriptions Tab -->
                <div id="subscriptionsContent" class="tab-content" style="display: none;">
                    <div class="search-filter">
                        <div class="search-box">
                            <input type="text" id="subscriptionSearch" placeholder="ุจุญุซ ูู ุงูุงุดุชุฑุงูุงุช..." onkeyup="filterSubscriptions()">
                        </div>
                    </div>
                    <div id="subscriptionsContainer">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <p>ุฌุงุฑู ุชุญููู ุจูุงูุงุช ุงูุงุดุชุฑุงูุงุช...</p>
                        </div>
                    </div>
                </div>

                <!-- Payments Tab -->
                <div id="paymentsContent" class="tab-content" style="display: none;">
                    <div class="search-filter">
                        <div class="search-box">
                            <input type="text" id="paymentSearch" placeholder="ุจุญุซ ูู ุงููุฏููุนุงุช..." onkeyup="filterPayments()">
                        </div>
                    </div>
                    <div id="paymentsContainer">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <p>ุฌุงุฑู ุชุญููู ุจูุงูุงุช ุงููุฏููุนุงุช...</p>
                        </div>
                    </div>
                </div>

                <!-- Attendances Tab -->
                            <div id="attendancesContent" class="tab-content" style="display: none;">
                                <button class="btn btn-success" onclick="exportAttendancesExcel()" style="margin-bottom: 20px; margin-right:10px;">
    <i class="fas fa-file-excel"></i> ุชุญููู ุจูุงูุงุช ุงูุญุถูุฑ
    </button>

                    <div class="search-filter">
                        <div class="search-box">
                            <input type="text" id="attendanceSearch" placeholder="ุจุญุซ ูู ุงูุญุถูุฑ..." onkeyup="filterAttendances()">
                        </div>
                    </div>
                                                                    <!-- Secretary attendance box: compact with show-log and check in/out buttons -->
                                                                    <div class="card" id="secretaryPanel" style="    margin-bottom: 18px;
        display: flex
    ;
        justify-content: space-between;
        align-items: center;
        padding: 12px;
        border: 10px solid var(--warning);    color: var(--primary);">
                                                                        <div>
                                                                            <h3 style="margin:0 0 6px 0;">ุญุถูุฑ ูุงูุตุฑุงู ุงูุณูุฑุชูุฑ</h3>
                                                                            <p id="secretaryStatus" style="margin:0;color:var(--gray);font-size:0.95rem;">ุฌุงุฑู ุงูุชุญูู...</p>
                                                                            <div style="margin-top: 8px;
        display: flex
    ;
        gap: 8px;
        margin-left: 20px;">
                                                                                <button id="secCheckIn" class="btn btn-success">ุชุณุฌูู ุงูุญุถูุฑ</button>
                                                                                <button id="secCheckOut" class="btn btn-danger">ุชุณุฌูู ุงูุงูุตุฑุงู</button>
                                                                            </div>
                                                                        </div>
                                                                        <div>
                                                                            <button style="top: 40px;" id="secShowLog" class="btn btn-primary">ุนุฑุถ ุงูุณุฌู</button>
                                                                        </div>
                                                                    </div>
                                                                    <div id="secretaryLogWrapper" style="display:none;margin-bottom:12px;">
                                                                        <div id="secretaryLog"></div>
                                                                    </div>

                                    <div style="  border: 10px solid var(--warning);
        color: var(--primary);" id="attendancesContainer">
                                            <div class="loading">
                                                    <div class="loading-spinner"></div>
                                                    <p>ุฌุงุฑู ุชุญููู ุจูุงูุงุช ุงูุญุถูุฑ...</p>
                                            </div>
                                    </div>
                </div>
            </div>
    </div>
        
    <!-- Status Message -->
    <div id="status"></div>

    <!-- Student Modal -->
    <div id="studentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="studentModalTitle">ุฅุถุงูุฉ ุทุงูุจ ุฌุฏูุฏ</h2>
                <button class="close" onclick="closeModal('studentModal')">&times;</button>
            </div>
            <form id="studentForm">
                <div class="modal-body">
                    <input type="hidden" id="studentId">
                    <div class="form-group">
                        <label for="fullName">ุงูุงุณู ุงููุงูู</label>
                        <input type="text" id="fullName" required>
                    </div>
                    <!-- ุฏุงุฎู studentModalุ ุถูู ูุณู ุชุนุฏูู ุงูุทุงูุจ -->
    <div class="form-group">
    <label for="editStudentAvatar">ุชุบููุฑ ุงูุตูุฑุฉ ุงูุดุฎุตูุฉ:</label>
    <input type="file" id="editStudentAvatar" name="editStudentAvatar" accept="image/*">
    <img id="editAvatarPreview" src="" alt="ูุนุงููุฉ ุงูุตูุฑุฉ" style="display:none; max-width: 100px; max-height: 100px; margin-top: 10px; border-radius: 50%;">
    </div>
                    <div class="form-group">
                        <label for="email">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
                        <input type="email" id="email">
                    </div>
                    <div class="form-group">
                        <label for="phone">ุฑูู ุงููุงุชู</label>
                        <input type="text" id="phone">
                    </div>
                    <!-- ุจุฏุงูุฉ ุฅุถุงูุฉ ุญูู ุฑูู ููู ุงูุฃูุฑ -->
                    <div class="form-group">
                        <label for="parentPhone">ุฑูู ูุงุชู ููู ุงูุฃูุฑ</label>
                        <input type="text" id="parentPhone">
                    </div>
                    <!-- ููุงูุฉ ุฅุถุงูุฉ ุญูู ุฑูู ููู ุงูุฃูุฑ -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('studentModal')">ุฅูุบุงุก</button>
                    <button type="submit" class="btn btn-primary">ุญูุธ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Course Modal -->
    <div id="courseModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="courseModalTitle">ุฅุถุงูุฉ ููุฑุณ ุฌุฏูุฏ</h2>
                    <button class="close" onclick="closeModal('courseModal')">&times;</button>
                </div>
                <form id="courseForm">
                    <div class="modal-body">
                        <input type="hidden" id="courseId">
                        <div class="form-group">
                            <label for="courseName">ุงุณู ุงูููุฑุณ</label>
                            <input type="text" id="courseName" required>
                        </div>
                        <div class="form-group">
                            <label for="courseDescription">ุงููุตู</label>
                            <textarea id="courseDescription" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="coursePrice">ุงูุณุนุฑ (ุฌ.ู)</label>
                            <input type="number" id="coursePrice" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="teacher">ุงููุนูู ุงููุณุคูู</label>
                            <select id="teacher" required>
                                <option value="">ุงุฎุชุฑ ูุนููุงู</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="startDate">ุชุงุฑูุฎ ุงูุจุฏุงูุฉ</label>
                            <input type="date" id="startDate">
                        </div>
                        <div class="form-group">
                            <label for="endDate">ุชุงุฑูุฎ ุงูููุงูุฉ</label>
                            <input type="date" id="endDate">
                        </div>

                        <!-- ูุณู ุฅุถุงูุฉ ุงููุญุฏุงุช -->
                        <div class="form-section">
                            <h3>ุงููุญุฏุงุช</h3>
                            <div id="modulesContainer">
                                <!-- ุณูุชู ุฅุถุงูุฉ ุงูุญููู ุงูุฏููุงููููุฉ ููุง -->
                            </div>
                            <button type="button" class="btn btn-secondary" onclick="addModuleField()">ุฅุถุงูุฉ ูุญุฏุฉ</button>
                        </div>

                        <!-- ูุณู ุฅุถุงูุฉ ุงูุฏุฑูุณ -->
                        <div class="form-section">
                            <h3>ุงูุฏุฑูุณ</h3>
                            <div id="lessonsContainer">
                                <!-- ุณูุชู ุฅุถุงูุฉ ุงูุญููู ุงูุฏููุงููููุฉ ููุง -->
                            </div>
                            <button type="button" class="btn btn-secondary" onclick="addLessonField()">ุฅุถุงูุฉ ุฏุฑุณ</button>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('courseModal')">ุฅูุบุงุก</button>
                        <button type="submit" class="btn btn-primary">ุญูุธ</button>
                    </div>
                </form>
            </div>
    </div>

    <!-- Full Subscription Modal -->
    <div id="subscriptionModal" class="modal">
    <div class="modal-content">
    <div class="modal-header">
    <h2 id="subscriptionModalTitle">ุฅุถุงูุฉ ุงุดุชุฑุงู ุดุงูู</h2>
    <button class="close" onclick="closeModal('subscriptionModal')">&times;</button>
    </div>
    <form id="subscriptionForm">
    <div class="modal-body">
        
        <!-- ุจูุงูุงุช ุงูุทุงูุจ -->
        <h3>ุจูุงูุงุช ุงูุทุงูุจ</h3>
        <div class="form-group">
        <label for="studentName">ุงุณู ุงูุทุงูุจ</label>
        <input type="text" id="studentName" placeholder="ุงูุชุจ ุงุณู ุงูุทุงูุจ" required>
        </div>
        <!-- ุฏุงุฎู Modalุ ุถูู ูุณู ุจูุงูุงุช ุงูุทุงูุจ -->
    <div class="form-group">
    <label for="studentAvatar">ุงูุตูุฑุฉ ุงูุดุฎุตูุฉ:</label>
    <input type="file" id="studentAvatar" name="studentAvatar" accept="image/*">
    <!-- ูุนุงููุฉ ุงูุตูุฑุฉ -->
    <img id="avatarPreview" src="" alt="ูุนุงููุฉ ุงูุตูุฑุฉ" style="display:none; max-width: 100px; max-height: 100px; margin-top: 10px; border-radius: 50%;">
    </div>
        <div class="form-group">
        <label for="studentPhone">ุฑูู ุงููุงุชู</label>
        <input type="text" id="studentPhone" placeholder="ุงูุชุจ ุฑูู ุงููุงุชู">
        </div>
        <div class="form-group">
    <label for="studentParentPhone">ุฑูู ููู ุงูุฃูุฑ</label>
    <input type="text" id="studentParentPhone" name="studentParentPhone" class="form-control" placeholder="ุฃุฏุฎู ุฑูู ููู ุงูุฃูุฑ">
    </div>

        <div class="form-group">
        <label for="studentEmail">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
        <input type="email" id="studentEmail" placeholder="ุงูุชุจ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู">
        </div>

        <hr>

        <!-- ุชูุงุตูู ุงูููุฑุณ -->
        <h3>ุชูุงุตูู ุงูููุฑุณ</h3>
    <div class="form-group">
    <label for="courseSelect">ุงูููุฑุณ</label>
    <select id="courseSelect" required onchange="updateCoursePrice()">
    <option value="">ุงุฎุชุฑ ููุฑุณุงู</option>
    </select>
    </div>


    <div class="form-group">
    <label for="paymentAmount">ุงููุจูุบ ุงููุฏููุน</label>
    <input type="number" id="paymentAmount" placeholder="0" oninput="calculateRemaining()">
    </div>

    <div class="form-group">
    <label>ุงููุชุจูู</label>
    <input type="text" id="remainingAmount" readonly>
    </div>


    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeModal('subscriptionModal')">ุฅูุบุงุก</button>
        <button type="submit" class="btn btn-primary">ุญูุธ ุงูุงุดุชุฑุงู</button>
    </div>
    </form>
    </div>
    </div>

    <!-- Payment Modal -->
    <div id="paymentModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="paymentModalTitle">ุฅุถุงูุฉ ุฏูุนุฉ ุฌุฏูุฏุฉ</h2>
                    <button class="close" onclick="closeModal('paymentModal')">&times;</button>
                </div>
                <form id="paymentForm">
                    <div class="modal-body">
                        <input type="hidden" id="paymentId">
                        <div class="form-group">
                            <label for="paymentStudent">ุงูุทุงูุจ</label>
                            <select id="paymentStudent" required>
                                <option value="">ุงุฎุชุฑ ุทุงูุจุงู</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="paymentCourse">ุงูููุฑุณ</label>
                            <select id="paymentCourse" required>
                                <option value="">ุงุฎุชุฑ ููุฑุณุงู</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="amount">ุงููุจูุบ ุงููุฏููุน (ุฌ.ู)</label>
                            <input type="number" id="amount" step="0.01" required>
                        </div>
                            <div class="form-group">
                            <label for="remainingAmount">ุงููุจูุบ ุงููุชุจูู (ุฌ.ู)</label>
                            <input type="number" id="remainingAmount" step="0.01" readonly style="background-color: #f0f0f0;">
                        </div>
                        <div class="form-group">
                            <label for="totalAmount">ุฅุฌูุงูู ุงูููุฑุณ (ุฌ.ู)</label>
                            <input type="number" id="totalAmount" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="paymentMethod">ุทุฑููุฉ ุงูุฏูุน</label>
                            <select id="paymentMethod" required>
                                <option value="cash">ููุฏุงู</option>
                                <option value="card">ุจุทุงูุฉ</option>
                                <option value="transfer">ุชุญููู</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="paymentDate">ุชุงุฑูุฎ ุงูุฏูุน</label>
                            <input type="date" id="paymentDate" required>
                        </div>
                        <div class="form-group">
                            <label for="paymentStatus">ุงูุญุงูุฉ</label>
                            <select id="paymentStatus" required>
                                <option value="paid">ูุฏููุน</option>
                                <option value="pending">ูุนูู</option>
                                <option value="cancelled">ููุบู</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="paymentNotes">ููุงุญุธุงุช</label>
                            <textarea id="paymentNotes" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('paymentModal')">ุฅูุบุงุก</button>
                        <button type="submit" class="btn btn-primary">ุญูุธ</button>
                    </div>
                </form>
            </div>
    </div>

    <!-- Attendance Modal -->
    <div id="attendanceModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="attendanceModalTitle">ุฅุถุงูุฉ ุญุถูุฑ ุฌุฏูุฏ</h2>
                    <button class="close" onclick="closeModal('attendanceModal')">&times;</button>
                </div>
                <form id="attendanceForm">
                    <div class="modal-body">
                        <input type="hidden" id="attendanceId">
                        <div class="form-group">
                            <label for="attendanceStudent">ุงูุทุงูุจ</label>
                            <select id="attendanceStudent" required>
                                <option value="">ุงุฎุชุฑ ุทุงูุจุงู</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="attendanceCourse">ุงูููุฑุณ</label>
                            <select id="attendanceCourse" required>
                                <option value="">ุงุฎุชุฑ ููุฑุณุงู</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="attendanceDate">ุงูุชุงุฑูุฎ</label>
                            <input type="date" id="attendanceDate" required>
                        </div>
                        <div class="form-group">
                            <label for="attendanceStatus">ุงูุญุงูุฉ</label>
                            <select id="attendanceStatus" required>
                                <option value="present">ุญุงุถุฑ</option>
                                <option value="absent">ุบุงุฆุจ</option>
                                <option value="late">ูุชุฃุฎุฑ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="attendanceNotes">ููุงุญุธุงุช</label>
                            <textarea id="attendanceNotes" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('attendanceModal')">ุฅูุบุงุก</button>
                        <button type="submit" class="btn btn-primary">ุญูุธ</button>
                    </div>
                </form>
            </div>
    </div>

        <!-- Student Detail Modal -->
    <div id="studentDetailModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>ุชูุงุตูู ุงูุทุงูุจ</h2>
                    <button class="close" onclick="closeModal('studentDetailModal')">&times;</button>
                </div>
                <div class="modal-body" id="studentDetailContent">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>ุฌุงุฑู ุชุญููู ุชูุงุตูู ุงูุทุงูุจ...</p>
                    </div>
                </div>
            </div>
    </div>

    <!-- Student QR Modal -->
    <div id="studentQrModal" class="modal">
    <div class="modal-content" style="text-align:center;">
        <div class="modal-header">
        <h2 id="qrModalTitle">ููุฏ QR ููุทุงูุจ</h2>
        <button class="close" onclick="closeModal('studentQrModal')">&times;</button>
        </div>
        <div class="modal-body">
        <p id="qrStudentName" style="font-weight:bold;"></p>
        <div id="qrCanvas" style="margin:20px auto;"></div>
        <button class="btn btn-primary" onclick="window.print()">
            <i class="fas fa-print"></i> ุทุจุงุนุฉ
        </button>
        </div>
    </div>
    </div>


    <!-- Payment Receipt Modal -->
    <div id="paymentReceiptModal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header">
                    <h2>ุฅูุตุงู ุฏูุน</h2>
                    <button class="close" onclick="closeModal('paymentReceiptModal')">&times;</button>
                </div>
                <div class="modal-body" id="paymentReceiptContent">
                    <!-- ุณูุชู ููุก ุงููุญุชูู ุฏููุงููููุงู -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('paymentReceiptModal')">ุฅุบูุงู</button>
                    <button class="btn btn-primary" onclick="printPaymentReceipt()">ุทุจุงุนุฉ ุงูุฅูุตุงู</button>
                </div>
            </div>
    </div>

        <!-- Attendance Receipt Modal -->
    <div id="attendanceReceiptModal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header">
                    <h2>ุฅูุตุงู ุญุถูุฑ</h2>
                    <button class="close" onclick="closeModal('attendanceReceiptModal')">&times;</button>
                </div>
                <div class="modal-body" id="attendanceReceiptContent">
                    <!-- ุณูุชู ููุก ุงููุญุชูู ุฏููุงููููุงู -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('attendanceReceiptModal')">ุฅุบูุงู</button>
                    <button class="btn btn-primary" onclick="printAttendanceReceipt()">ุทุจุงุนุฉ ุงูุฅูุตุงู</button>
                </div>
            </div>
    </div>


    <!-- ูููุฐุฌ ุฅุฏุงุฑุฉ ุงูุงุฎุชุจุงุฑ -->
    <div id="examModal" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); justify-content: center; align-items: center; direction: rtl;">
    <div class="modal-content" style="
        background: white;
        width: 90%;
        max-width: 500px;
        border-radius: 12px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        overflow: hidden;
        animation: modalFadeIn 0.3s ease-out;
    ">
        <!-- ุฑุฃุณ ุงููููุฐุฌ -->
        <div style="background: #007bff; color: white; padding: 15px 20px; text-align: center; font-size: 1.2em; font-weight: 600;">
        <span id="examModalTitle">ุฅุถุงูุฉ ุงุฎุชุจุงุฑ ุฌุฏูุฏ</span>
        </div>

        <!-- ุฒุฑ ุงูุฅุบูุงู -->
        <span onclick="closeModal('examModal')" style="
        position: absolute;
        top: 15px;
        left: 20px;
        font-size: 24px;
        color: white;
        cursor: pointer;
        font-weight: bold;
        ">&times;</span>

        <!-- ูุญุชูู ุงููููุฐุฌ -->
        <form id="examForm" onsubmit="event.preventDefault(); saveExam();" style="padding: 25px;">
        <input type="hidden" id="examId">

        <!-- ุนููุงู ุงูุงุฎุชุจุงุฑ -->
        <div style="margin-bottom: 15px;">
            <label for="examTitle" style="display: block; margin-bottom: 6px; font-weight: 600; color: #333;">ุนููุงู ุงูุงุฎุชุจุงุฑ *</label>
            <input type="text" id="examTitle" required style="
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            background: #f9f9f9;
            ">
        </div>

        <!-- ุงูููุฑุณ -->
        <div style="margin-bottom: 15px;">
            <label for="examCourse" style="display: block; margin-bottom: 6px; font-weight: 600; color: #333;">ุงุฎุชุฑ ุงูููุฑุณ *</label>
            <select id="examCourse" required style="
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            background: #f9f9f9;
            ">
            <option value="">ุงุฎุชุฑ ููุฑุณุงู</option>
            </select>
        </div>

        <!-- ุงููุญุฏุฉ -->
        <div style="margin-bottom: 15px;">
            <label for="examModule" style="display: block; margin-bottom: 6px; font-weight: 600; color: #333;">ุงุฎุชุฑ ุงููุญุฏุฉ *</label>
            <select id="examModule" required style="
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            background: #f9f9f9;
            ">
            <option value="">ุงุฎุชุฑ ูุญุฏุฉ</option>
            </select>
        </div>

        <!-- ุงูุฏุฑุฌุฉ ุงููุตูู -->
        <div style="margin-bottom: 15px;">
            <label for="examMaxScore" style="display: block; margin-bottom: 6px; font-weight: 600; color: #333;">ุงูุฏุฑุฌุฉ ุงููุตูู *</label>
            <input type="number" id="examMaxScore" step="0.5" min="1" required style="
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            background: #f9f9f9;
            ">
        </div>


        <!-- ุฃุฒุฑุงุฑ ุงูุฅุฌุฑุงุกุงุช -->
        <div style="text-align: left; margin-top: 10px;">
            <button type="button" onclick="closeModal('examModal')" style="
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
            ">ุฅูุบุงุก</button>
            <button type="submit" style="
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            ">ุญูุธ</button>
        </div>
        </form>
    </div>
    </div>

    <!-- Modal for Editing Subscription -->
    <div id="editSubscriptionModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('editSubscriptionModal')">&times;</span>
        <h2 id="subscriptionModalTitle">ุชุนุฏูู ุจูุงูุงุช ุงูุงุดุชุฑุงู</h2>
        <form id="editSubscriptionForm">
        <div class="modal-body">

    <!-- Hidden fields for IDs -->
    <input type="hidden" id="editSubscriptionId">
    <input type="hidden" id="editStudentId">
    <input type="hidden" id="editCourseId">

    <!-- Student Info (Read-only) -->
    <div class="form-group">
    <label>ุงูุทุงูุจ</label>
    <p id="editStudentName" class="form-control-plaintext">-</p>
    </div>

    <!-- Course Info (Read-only) -->
    <div class="form-group">
    <label>ุงูุฏูุฑุฉ</label>
    <p id="editCourseName" class="form-control-plaintext">-</p>
    </div>

            <!-- Subscription Date -->
            <div class="form-group">
            <label for="editSubscriptionDate">ุชุงุฑูุฎ ุงูุงุดุชุฑุงู</label>
            <input type="date" id="editSubscriptionDate" required>
            </div>

            <!-- Status -->
            <div class="form-group">
            <label for="editSubscriptionStatus">ุงูุญุงูุฉ</label>
            <select id="editSubscriptionStatus" required>
                <option value="active">ูุดุท</option>
                <option value="inactive">ุบูุฑ ูุดุท</option>
            </select>
            </div>

            <!-- Notes -->
            <div class="form-group">
            <label for="editSubscriptionNotes">ููุงุญุธุงุช</label>
            <textarea id="editSubscriptionNotes" rows="3"></textarea>
            </div>

        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeModal('editSubscriptionModal')">ุฅูุบุงุก</button>
            <button type="submit" class="btn btn-primary">ุชุญุฏูุซ ุงูุงุดุชุฑุงู</button>
        </div>
        </form>
    </div>
    </div>
    <!-- ุฃูููุดู ุฏุฎูู ุงููููุฐุฌ -->

    </div>
    <!-- WhatsApp preview modal for parents report -->
    <div id="waPreviewModal" class="modal" style="display:none;">
    <div class="modal-content" style="max-width:720px;">
        <div class="modal-header">
        <h3>ูุนุงููุฉ ุฑุณุงูุฉ ูุงุชุณุงุจ</h3>
        <button class="close-modal" id="waPreviewClose">ร</button>
        </div>
        <div class="modal-body" style="padding:12px;">
        <p id="waPreviewPhone" style="font-weight:600;margin-bottom:8px;"></p>
        <textarea id="waPreviewMessage" readonly></textarea>
        </div>
        <div class="modal-footer">
        <button id="waCopyBtn" class="btn btn-secondary">ูุณุฎ ุงููุต</button>
        <button id="waOpenBtn" class="btn btn-primary">ูุชุญ ูุงุชุณุงุจ</button>
        <button id="waCloseBtn" class="btn">ุฅุบูุงู</button>
        </div>
    </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <!-- JS Files -->
    <script src="secretary-js/utils.js"></script>
    <script src="secretary-js/master.js"></script>
    <script src="secretary-js/cuorses.js"></script>
    <script src="secretary-js/students-tab.js"></script>
    <script src="secretary-js/teacher-exams-tab.js"></script>
    <script src="secretary-js/waModal.js"></script>
    <script src="secretary-js/autoRefresh.js"></script>
    <script src="secretary-js/tabRefresher.js"></script>
    <script src="secretary-js/dataManagement.js"></script>
    <script src="secretary-js/sidebarToggle.js"></script>
    <script src="secretary-js/tableResponsive.js"></script>
    <script src="secretary-js/secretaryLog.js"></script>


    </body>