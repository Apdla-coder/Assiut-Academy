    <!DOCTYPE html>
    <html lang="ar" dir="rtl">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ - ÿßŸÑÿ≥ŸÉÿ±ÿ™Ÿäÿ±</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="icon" href="logo2.jpg" type="image/jpeg">


    <style>
            :root {
                --primary: #f97316;
                --primary-dark: #ea580c;
                --primary-light: #fed7aa;
                --secondary: #059669;
                --secondary-light: #d1fae5;
                --dark: #1f2937;
                --light: #f9fafb;
                --gray: #6b7280;
                --gray-light: #f3f4f6;
                --border: #e5e7eb;
                --success: #10b981;
                --warning: #f59e0b;
                --danger: #ef4444;
                --info: #3b82f6;
                --waiting: #8b5cf6;
                --sidebar-width: 280px;
                --header-height: 70px;
                --shadow-light: 0 1px 3px rgba(0,0,0,0.1);
                --shadow-medium: 0 4px 6px rgba(0,0,0,0.1);
                --shadow-heavy: 0 10px 15px rgba(0,0,0,0.1);
                --radius-sm: 8px;
                --radius-md: 12px;
                --radius-lg: 16px;
            }

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                font-family: 'Tajawal', sans-serif;
            }

            body {
                background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
                color: var(--dark);
                display: flex;
                min-height: 100vh;
                line-height: 1.6;
            }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿ≤ÿ± ÿßŸÑŸÇÿßÿ¶ŸÖÿ© */
            #menuToggle {
                display: none;
                background: linear-gradient(135deg, var(--primary), var(--primary-dark));
                color: white;
                border: none;
                width: 45px;
                height: 45px;
                border-radius: var(--radius-md);
                cursor: pointer;
                font-size: 1.3rem;
                margin-right: 15px;
                box-shadow: var(--shadow-medium);
                transition: all 0.3s ease;
                position: relative;
                flex-shrink: 0; /* ŸÖŸáŸÖ ŸÑŸÖŸÜÿπ ÿßŸÑÿ∂ÿ∫ÿ∑ ŸÅŸä ÿßŸÑÿ™ÿÆÿ∑Ÿäÿ∑ */
            }

            #menuToggle:hover {
                transform: translateY(-2px);
                box-shadow: var(--shadow-heavy);
            }

            #menuToggle:active {
                transform: translateY(0);
            }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ¨ÿßŸÜÿ®Ÿä */
            .sidebar {
                width: var(--sidebar-width);
                background: linear-gradient(180deg, var(--primary) 0%, var(--primary-dark) 100%);
                color: white;
                height: 100vh;
                position: fixed;
                overflow-y: auto;
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                z-index: 100;
                box-shadow: 4px 0 15px rgba(0,0,0,0.15);
                backdrop-filter: blur(10px);
            }

            /* Ensure .sidebar.active shows the sidebar (fallback outside media queries) */
            .sidebar.active {
                transform: translateX(0) !important;
            }

            .sidebar::-webkit-scrollbar {
                width: 6px;
            }

            .sidebar::-webkit-scrollbar-track {
                background: rgba(255,255,255,0.1);
            }

            .sidebar::-webkit-scrollbar-thumb {
                background: rgba(255,255,255,0.3);
                border-radius: 3px;
            }

            .sidebar-header {
                padding: 25px 20px;
                text-align: center;
                border-bottom: 1px solid rgba(255,255,255,0.15);
                background: rgba(255,255,255,0.05);
            }

            .sidebar .logo {
                width: 140px;
                height: 140px;
                border-radius: 50%;
                margin-bottom: 15px;
                box-shadow: 0 8px 25px rgba(0,0,0,0.3);
                border: 4px solid rgba(255,255,255,0.2);
                transition: all 0.3s ease;
            }

            .sidebar .logo:hover {
                transform: scale(1.05);
                box-shadow: 0 12px 30px rgba(0,0,0,0.4);
            }

            .sidebar-header h3 {
                margin: 0;
                font-size: 1.6rem;
                font-weight: 600;
                text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            }

            .sidebar-menu {
                padding: 20px 0;
                list-style: none;
            }

            .nav-item {
                margin: 8px 0;
            }

            .nav-link {
                display: flex;
                align-items: center;
                padding: 18px 25px;
                color: rgba(255,255,255,0.9);
                text-decoration: none;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                border-right: 4px solid transparent;
                position: relative;
                font-weight: 500;
                font-size: 1.05rem;
            }

            .nav-link::before {
                content: '';
                position: absolute;
                top: 0;
                right: 0;
                width: 0;
                height: 100%;
                background: rgba(255,255,255,0.1);
                transition: width 0.3s ease;
            }

            .nav-link:hover::before {
                width: 100%;
            }

            .nav-link:hover, .nav-link.active {
                background: rgba(255,255,255,0.15);
                color: white;
                border-right: 4px solid white;
                transform: translateX(-5px);
            }

            .nav-link i {
                margin-left: 15px;
                font-size: 1.3rem;
                min-width: 25px;
            }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä */
    .main-content {
        flex: 1;
        /* ÿ∂ÿ®ÿ∑ ÿßŸÑŸÖÿ≥ÿßŸÅÿ© ÿßŸÑÿ¨ÿßŸÜÿ®Ÿäÿ© ŸÑÿ™ÿ±ŸÉ ŸÖŸÉÿßŸÜ ŸÑŸÑÿ¥ÿ±Ÿäÿ∑ */
        margin-right: var(--sidebar-width); 
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸáŸäÿØÿ± */
            .header {
                height: var(--header-height);
                background: white;
                box-shadow: 0 4px 20px rgba(0,0,0,0.08);
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0 30px;
                position: sticky;
                top: 0;
                z-index: 99;
                backdrop-filter: blur(10px);
                border-bottom: 1px solid var(--border);
            }

            .header-title h1 {
                font-size: 1.8rem;
                color: var(--dark);
                font-weight: 700;
                background: linear-gradient(135deg, var(--primary), var(--primary-dark));
                background-clip: text;
                -webkit-text-fill-color: transparent;
            }

            .user-info {
                display: flex;
                align-items: center;
                gap: 15px;
                padding: 10px 20px;
                background: var(--gray-light);
                border-radius: var(--radius-lg);
                transition: all 0.3s ease;
            }

            .user-info:hover {
                background: var(--primary-light);
                transform: translateY(-2px);
                box-shadow: var(--shadow-medium);
            }

            .user-info span {
                font-weight: 600;
                color: var(--dark);
            }

            .user-info img {
                width: 45px;
                height: 45px;
                border-radius: 50%;
                object-fit: cover;
                border: 3px solid var(--primary);
                box-shadow: var(--shadow-light);
            }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ */
            .content {
                padding: 30px;
            }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ */
            .stats {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 25px;
                margin-bottom: 40px;
            }

            .stat-card {
                background: white;
                border-radius: var(--radius-lg);
                padding: 30px;
                box-shadow: var(--shadow-light);
                display: flex;
                align-items: center;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                border: 1px solid var(--border);
                position: relative;
                overflow: hidden;
            }

            .stat-card::before {
                content: '';
                position: absolute;
                top: 0;
                right: 0;
                width: 100%;
                height: 4px;
                background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            }

            .stat-card:hover {
                transform: translateY(-8px);
                box-shadow: 0 15px 35px rgba(0,0,0,0.15);
                border-color: var(--primary-light);
            }

            .stat-icon {
                width: 70px;
                height: 70px;
                border-radius: var(--radius-md);
                display: flex;
                align-items: center;
                justify-content: center;
                margin-left: 20px;
                font-size: 1.8rem;
                color: white;
                position: relative;
            }

            .stat-icon::before {
                content: '';
                position: absolute;
                inset: 0;
                background: inherit;
                border-radius: inherit;
                opacity: 0.8;
                filter: blur(8px);
            }

            .stat-text h3 {
                font-size: 2.2rem;
                margin-bottom: 8px;
                font-weight: 700;
                color: var(--dark);
            }

            .stat-text p {
                color: var(--gray);
                font-size: 1rem;
                font-weight: 500;
            }

            .bg-primary { 
                background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            }
            .bg-success { 
                background: linear-gradient(135deg, var(--success), #059669);
            }
            .bg-warning { 
                background: linear-gradient(135deg, var(--warning), #d97706);
            }
            .bg-info { 
                background: linear-gradient(135deg, var(--info), #2563eb);
            }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ£ÿÆŸäÿ± */
            .recent-activity {
                background: white;
                border-radius: var(--radius-lg);
                padding: 30px;
                box-shadow: var(--shadow-light);
                margin-bottom: 40px;
                border: 1px solid var(--border);
            }

            .recent-activity h2 {
                margin-bottom: 25px;
                color: var(--dark);
                font-size: 1.6rem;
                font-weight: 600;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .recent-activity h2::before {
                content: '';
                width: 4px;
                height: 30px;
                background: linear-gradient(180deg, var(--primary), var(--primary-dark));
                border-radius: 2px;
            }

            .activity-list {
                list-style: none;
            }

            .activity-item {
                display: flex;
                padding: 20px 0;
                border-bottom: 1px solid var(--border);
                transition: all 0.3s ease;
            }

            .activity-item:hover {
                background: var(--gray-light);
                margin: 0 -30px;
                padding: 20px 30px;
                border-radius: var(--radius-md);
                border-bottom: 1px solid transparent;
            }

            .activity-item:last-child {
                border-bottom: none;
            }

            .activity-icon {
                width: 50px;
                height: 50px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                margin-left: 20px;
                font-size: 1.2rem;
                color: white;
                box-shadow: var(--shadow-light);
            }

            .activity-content {
                flex: 1;
            }

            .activity-content h4 {
                margin-bottom: 8px;
                font-size: 1.1rem;
                font-weight: 600;
                color: var(--dark);
            }

            .activity-content p {
                color: var(--gray);
                font-size: 0.95rem;
                margin-bottom: 8px;
            }

            .activity-content small {
                color: var(--gray);
                font-size: 0.85rem;
            }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ±ÿ≥ŸàŸÖ ÿßŸÑÿ®ŸäÿßŸÜŸäÿ© */
            .charts {
                display: grid;
                grid-template-columns: 2fr 1fr;
                gap: 30px;
                margin-bottom: 40px;
            }

            .chart-container {
                background: white;
                border-radius: var(--radius-lg);
                padding: 30px;
                box-shadow: var(--shadow-light);
                border: 1px solid var(--border);
                transition: all 0.3s ease;
            }

            .chart-container:hover {
                box-shadow: var(--shadow-medium);
            }

            .chart-container h2 {
                margin-bottom: 25px;
                color: var(--dark);
                font-size: 1.5rem;
                font-weight: 600;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .chart-container h2::before {
                content: '';
                width: 4px;
                height: 25px;
                background: linear-gradient(180deg, var(--primary), var(--primary-dark));
                border-radius: 2px;
            }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ */
            .loading {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                padding: 60px 40px;
            }

            .loading-spinner {
                border: 4px solid rgba(249, 115, 22, 0.1);
                border-radius: 50%;
                border-top: 4px solid var(--primary);
                width: 50px;
                height: 50px;
                animation: spin 1s linear infinite;
                margin-bottom: 20px;
            }

            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ¨ÿØÿßŸàŸÑ */
            .table-container {
                overflow-x: auto;
                background: white;
                border-radius: var(--radius-lg);
                padding: 30px;
                box-shadow: var(--shadow-light);
                border: 1px solid var(--border);
            }

            table {
                width: 100%;
                border-collapse: collapse;
                margin: 25px 0;
            }

            th, td {
                padding: 15px 20px;
                text-align: right;
                border-bottom: 1px solid var(--border);
                transition: all 0.3s ease;
            }

            th {
                background: linear-gradient(135deg, var(--gray-light), #e5e7eb);
                font-weight: 600;
                color: var(--dark);
                font-size: 1.05rem;
                position: sticky;
                top: 0;
            }

            tr:hover {
                background-color: rgba(249, 115, 22, 0.05);
                transform: scale(1.01);
            }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿ≠ÿßŸÑÿ© */
            #status {
                position: fixed;
                top: 30px;
                right: 30px;
                padding: 20px 30px;
                border-radius: var(--radius-md);
                font-weight: 600;
                transform: translateX(150%);
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                z-index: 1000;
                box-shadow: 0 15px 35px rgba(0,0,0,0.2);
                backdrop-filter: blur(10px);
            }

            #status.show {
                transform: translateX(0);
            }

            #status.success {
                background: linear-gradient(135deg, var(--success), #059669);
                color: white;
            }

            #status.error {
                background: linear-gradient(135deg, var(--danger), #dc2626);
                color: white;
            }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÜŸàÿßŸÅÿ∞ ÿßŸÑŸÖŸÜÿ®ÿ´ŸÇÿ© */
            .modal {
                display: none;
                position: fixed;
                z-index: 1000;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(8px);
                align-items: center;
                justify-content: center;
                padding: 20px;
            }

            .modal-content {
                background: white;
                border-radius: var(--radius-lg);
                width: 95%;
                max-width: 700px;
                max-height: 95vh;
                overflow-y: auto;
                box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
                border: 1px solid var(--border);
                position: relative;
                animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            }

            .modal-content h3 {
                margin-bottom: 25px;
                color: var(--dark);
                font-weight: 600;
            }

            .modal-content p {
                margin-bottom: 20px;
                margin-top: 20px;
                line-height: 1.7;
            }

            @keyframes modalSlideIn {
                from {
                    opacity: 0;
                    transform: translateY(50px) scale(0.9);
                }
                to {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
            }

            .modal-header {
                padding: 30px 35px;
                border-bottom: 1px solid var(--border);
                display: flex;
                justify-content: space-between;
                align-items: center;
                background: linear-gradient(135deg, #fcfcfc, #f8fafc);
                border-top-left-radius: var(--radius-lg);
                border-top-right-radius: var(--radius-lg);
            }

            .modal-header h2 {
                margin: 0;
                color: var(--dark);
                font-size: 1.6rem;
                font-weight: 700;
            }

            .close {
                font-size: 2rem;
                cursor: pointer;
                color: var(--gray);
                border: none;
                background: none;
                width: 45px;
                height: 45px;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: var(--radius-md);
                transition: all 0.3s ease;
            }

            .close:hover {
                color: var(--danger);
                background: rgba(239, 68, 68, 0.1);
                transform: scale(1.1);
            }

            .modal-body {
                padding: 35px;
            }

            .form-group {
                margin-bottom: 25px;
            }

            .form-group label {
                display: block;
                margin-bottom: 10px;
                font-weight: 600;
                color: var(--dark);
                font-size: 1rem;
            }

            .form-group input,
            .form-group select,
            .form-group textarea {
                width: 100%;
                padding: 15px 20px;
                border: 2px solid var(--border);
                border-radius: var(--radius-md);
                font-size: 1rem;
                transition: all 0.3s ease;
                background-color: #fdfdfd;
                font-family: inherit;
            }

            .form-group input:focus,
            .form-group select:focus,
            .form-group textarea:focus {
                outline: none;
                border-color: var(--primary);
                box-shadow: 0 0 0 4px rgba(249, 115, 22, 0.15);
                background-color: white;
                transform: translateY(-2px);
            }

            .modal-footer {
                padding: 25px 35px;
                border-top: 1px solid var(--border);
                display: flex;
                justify-content: flex-end;
                gap: 15px;
                background: linear-gradient(135deg, #fcfcfc, #f8fafc);
                border-bottom-left-radius: var(--radius-lg);
                border-bottom-right-radius: var(--radius-lg);
            }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± */
            .btn {
        padding: 15px 30px;
        border: none;
        border-radius: var(--radius-md);
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        min-width: 100px;
        display: inline-flex
    ;
        align-items: center;
        justify-content: center;
        gap: 8px;
        position: relative;
        overflow: hidden;
        font-family: inherit;
        background-color: forestgreen;
        color: white;
            }

            .btn::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                transition: left 0.6s;
            }

            .btn:hover::before {
                left: 100%;
            }

            .btn-primary {
                background: linear-gradient(135deg, var(--primary), var(--primary-dark));
                color: white;
                box-shadow: 0 6px 15px rgba(249, 115, 22, 0.3);
            }

            .btn-primary:hover {
                background: linear-gradient(135deg, var(--primary-dark), #c2410c);
                transform: translateY(-3px);
                box-shadow: 0 10px 25px rgba(249, 115, 22, 0.4);
            }

            .btn-secondary {
                background: linear-gradient(135deg, var(--gray), #4b5563);
                color: white;
                box-shadow: 0 6px 15px rgba(107, 114, 128, 0.2);
            }

            .btn-secondary:hover {
                background: linear-gradient(135deg, #4b5563, #374151);
                transform: translateY(-3px);
                box-shadow: 0 10px 25px rgba(107, 114, 128, 0.3);
            }

            .btn-danger {
                background: linear-gradient(135deg, var(--danger), #dc2626);
                color: white;
                box-shadow: 0 6px 15px rgba(239, 68, 68, 0.3);
            }

            .btn-danger:hover {
                background: linear-gradient(135deg, #dc2626, #b91c1c);
                transform: translateY(-3px);
                box-shadow: 0 10px 25px rgba(239, 68, 68, 0.4);
            }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™ */
            .action-buttons {
                display: flex;
                gap: 8px;
            }

            .action-btn {
                padding: 8px 15px;
                border: none;
                border-radius: var(--radius-sm);
                cursor: pointer;
                font-size: 0.9rem;
                font-weight: 500;
                transition: all 0.3s ease;
                min-width: auto;
            }

            .edit-btn {
                background: linear-gradient(135deg, var(--warning), #d97706);
                color: white;
            }

            .edit-btn:hover {
                background: linear-gradient(135deg, #d97706, #b45309);
                transform: translateY(-2px);
            }

            .delete-btn {
                background: linear-gradient(135deg, var(--danger), #dc2626);
                color: white;
            }

            .delete-btn:hover {
                background: linear-gradient(135deg, #dc2626, #b91c1c);
                transform: translateY(-2px);
            }

            .view-btn {
                background: linear-gradient(135deg, var(--info), #2563eb);
                color: white;
            }

            .view-btn:hover {
                background: linear-gradient(135deg, #2563eb, #1d4ed8);
                transform: translateY(-2px);
            }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ®ÿ≠ÿ´ ŸàÿßŸÑÿ™ÿµŸÅŸäÿ© */
            .search-filter {
                display: flex;
                gap: 20px;
                margin-bottom: 30px;
                flex-wrap: wrap;
            }

            .search-box {
                flex: 1;
                min-width: 250px;
            }

            .filter-box {
                min-width: 180px;
            }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿ∑ÿ±ŸÇ ÿßŸÑÿØŸÅÿπ */
            .payment-method {
                padding: 6px 15px;
                border-radius: 20px;
                font-size: 0.85rem;
                font-weight: 600;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .payment-method.cash {
                background: linear-gradient(135deg, #d1fae5, #a7f3d0);
                color: #065f46;
                border: 1px solid #059669;
            }

            .payment-method.card {
                background: linear-gradient(135deg, #dbeafe, #bfdbfe);
                color: #1e40af;
                border: 1px solid #3b82f6;
            }

            .payment-method.transfer {
                background: linear-gradient(135deg, #fef3c7, #fde68a);
                color: #92400e;
                border: 1px solid #f59e0b;
            }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ≠ÿ∂Ÿàÿ± */
            .attendance-status {
                padding: 6px 15px;
                border-radius: 20px;
                font-size: 0.85rem;
                font-weight: 600;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .attendance-status.present {
                background: linear-gradient(135deg, #d1fae5, #a7f3d0);
                color: #065f46;
                border: 1px solid #10b981;
            }

            .attendance-status.absent {
                background: linear-gradient(135deg, #fee2e2, #fecaca);
                color: #991b1b;
                border: 1px solid #ef4444;
            }

            .attendance-status.late {
                background: linear-gradient(135deg, #fef3c7, #fde68a);
                color: #92400e;
                border: 1px solid #f59e0b;
            }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ•ŸäÿµÿßŸÑÿßÿ™ */
            .receipt-header {
                text-align: center;
                margin-bottom: 30px;
                padding: 20px;
                background: linear-gradient(135deg, var(--primary-light), #fed7aa);
                border-radius: var(--radius-md);
            }

            .receipt-logo {
                margin-bottom: 20px;
            }

            .receipt-logo h2 {
                background: linear-gradient(135deg, var(--primary), var(--primary-dark));
                background-clip: text;
                -webkit-text-fill-color: transparent;
                margin: 0;
                font-size: 2rem;
                font-weight: 700;
            }

            .receipt-details {
                text-align: right;
                margin: 25px 0;
                padding: 20px;
                background: var(--gray-light);
                border-radius: var(--radius-md);
            }

            .receipt-details p {
                margin: 10px 0;
                font-weight: 500;
            }

            .receipt-stats {
                background: linear-gradient(135deg, var(--light), #f3f4f6);
                padding: 20px;
                border-radius: var(--radius-md);
                margin: 20px 0;
                border: 2px solid var(--border);
            }

            .receipt-table {
                width: 100%;
                border-collapse: collapse;
                margin: 20px 0;
            }

            .receipt-table th,
            .receipt-table td {
                border: 1px solid var(--border);
                padding: 12px 15px;
                text-align: right;
            }

            .receipt-table th {
                background: linear-gradient(135deg, var(--primary-light), #fed7aa);
                font-weight: 600;
                color: var(--dark);
            }

            .receipt-footer {
                text-align: center;
                margin-top: 40px;
                padding: 20px;
                font-style: italic;
                color: var(--gray);
                border-top: 2px dashed var(--border);
            }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿπŸÑÿßŸÖÿßÿ™ ÿßŸÑÿ™ÿ®ŸàŸäÿ® */
            .course-detail-tabs {
                display: flex;
                border-bottom: 2px solid var(--border);
                margin-bottom: 30px;
                background: var(--gray-light);
                border-radius: var(--radius-md) var(--radius-md) 0 0;
                overflow: hidden;
            }

            .tab-button {
                padding: 15px 25px;
                cursor: pointer;
                border: none;
                background-color: transparent;
                border-bottom: 3px solid transparent;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                font-weight: 600;
                color: var(--gray);
                font-size: 1rem;
                position: relative;
            }

            .tab-button::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 0;
                height: 100%;
                background: rgba(249, 115, 22, 0.1);
                transition: width 0.3s ease;
            }

            .tab-button:hover::before {
                width: 100%;
            }

            .tab-button:hover {
                color: var(--primary);
                background: rgba(249, 115, 22, 0.05);
            }

            .tab-button.active {
                color: var(--primary);
                border-bottom-color: var(--primary);
                background: white;
                box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
            }

            /* Responsive tab behaviour: wrap or scroll on small screens */
            .course-detail-tabs {
                gap: 6px;
            }

            /* Make tab content comfortable on small screens */
            .course-detail-tab-content {
                padding: 12px 0 0 0;
            }

            @media (max-width: 768px) {

                /* Stack tab buttons vertically on small screens for easier tapping */
                .course-detail-tabs {
                    display: flex;
                    flex-wrap: wrap; /* allow wrapping to multiple rows */
                    overflow-x: visible;
                    -webkit-overflow-scrolling: auto;
                    gap: 8px;
                    padding: 6px 8px;
                }

                /* Make each tab button take full width (RTL: align right) */
                .course-detail-tabs .tab-button {
                    flex: 1 1 100%;
                    min-width: 0;
                    padding: 12px 14px;
                    font-size: 1rem;
                    text-align: right; /* RTL alignment */
                    border-radius: 10px;
                    background: transparent;
                    white-space: normal;
                }

                .course-detail-tabs .tab-button.active {
                    background: white;
                    box-shadow: 0 6px 20px rgba(0,0,0,0.06);
                    border-bottom-color: transparent; /* use card highlight instead */
                }

                /* Make the content area use full width and comfortable padding */
                .course-detail-tab-content {
                    padding: 12px 8px 24px 8px;
                }

                /* Improve module/lesson layouts for mobile */
                .module-card, .lesson-item, .student-subscriptions-section, .student-payments-section {
                    padding: 16px;
                }
                /* Make sidebar nav links larger and wrap text for easier tapping */
                .sidebar .nav-link {
                    padding: 14px 18px;
                    font-size: 1.05rem;
                    white-space: normal;
                }

                /* Ensure header items align well with toggle */
                .header { padding-left: 12px; padding-right: 12px; }
            }

            /* Secretary log card styles */
            .secretary-log { display:flex; flex-direction:column; gap:12px; }
            .secretary-log-card {
                background: linear-gradient(180deg,#ffffff,#fbfbfd);
                border: 1px solid var(--border);
                border-radius: 12px;
                padding: 12px 14px;
                box-shadow: 0 6px 18px rgba(15,23,42,0.06);
                display: flex;
                justify-content:center;
                align-items: center;
                gap: 12px;
            }
            .secretary-log-meta { text-align: right; }
            .secretary-log-meta strong { color: var(--primary); margin-left:6px; }
            .secretary-log-time { color: var(--gray); font-size:0.95rem; }

            /* Responsive tables: stack rows vertically on small screens */
            @media (max-width: 768px) {
                table.responsive, table {
                    width: 100%;
                    border: 0;
                    background: transparent;
                }

                table thead {
                    display: none; /* hide header row on mobile */
                }

                table, tbody, tr, td {
                    display: block;
                    width: 100%;
                }

                tr {
                    margin-bottom: 12px;
                    border: 1px solid var(--border);
                    border-radius: 10px;
                    padding: 10px;
                    background: white;
                }

                td {
                    padding: 8px 10px;
                    text-align: right; /* RTL */
                    position: relative;
                    border: none;
                }

                /* show header label above cell value using data-label set by JS */
                td::before {
                    content: attr(data-label) ": ";
                    display: block;
                    font-weight: 700;
                    color: var(--gray);
                    margin-bottom: 6px;
                    text-align: right;
                }
            }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ ŸÇÿ≥ŸÖ ÿßŸÑŸàÿ≠ÿØÿßÿ™ */
            .modules-section {
                margin-top: 30px;
            }

            .module-card {
                background: white;
                border: 2px solid var(--border);
                border-radius: var(--radius-md);
                padding: 25px;
                margin-bottom: 20px;
                box-shadow: var(--shadow-light);
                transition: all 0.3s ease;
                position: relative;
                overflow: hidden;
            }

            .module-card::before {
                content: '';
                position: absolute;
                top: 0;
                right: 0;
                width: 100%;
                height: 4px;
                background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            }

            .module-card:hover {
                transform: translateY(-5px);
                box-shadow: var(--shadow-medium);
                border-color: var(--primary-light);
            }

            .module-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 15px;
            }

            .module-title {
                font-size: 1.3rem;
                font-weight: 700;
                color: var(--dark);
                margin: 0;
            }

            .module-description {
                color: var(--gray);
                margin-bottom: 15px;
                font-size: 1rem;
                line-height: 1.6;
            }

            .module-actions {
                display: flex;
                gap: 10px;
            }

            .lessons-section {
                margin-top: 20px;
                padding-top: 20px;
                border-top: 2px dashed var(--border);
            }

            .lessons-section h4 {
                margin-bottom: 15px;
                color: var(--primary);
                font-weight: 600;
                font-size: 1.1rem;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .lessons-section h4::before {
                content: 'üìö';
                font-size: 1.2rem;
            }

            .lesson-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 12px 0;
                border-bottom: 1px solid #eee;
                transition: all 0.3s ease;
            }

            .lesson-item:hover {
                background: var(--gray-light);
                margin: 0 -25px;
                padding: 12px 25px;
                border-radius: var(--radius-sm);
            }

            .lesson-item:last-child {
                border-bottom: none;
            }

            .lesson-title {
                font-weight: 600;
                color: var(--dark);
            }

            .lesson-date {
                font-size: 0.9rem;
                color: var(--gray);
                font-weight: 500;
            }

            .lesson-actions {
                display: flex;
                gap: 8px;
            }

            .no-data {
                text-align: center;
                color: var(--gray);
                padding: 40px 20px;
                font-style: italic;
                font-size: 1.1rem;
                background: var(--gray-light);
                border-radius: var(--radius-md);
                border: 2px dashed var(--border);
            }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ Modal ÿßŸÑŸÉÿ®Ÿäÿ± */
            .modal-content.modal-lg {
                max-width: 900px;
                width: 95%;
            }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßÿ¥ÿ™ÿ±ÿßŸÉÿßÿ™ ŸàŸÖÿØŸÅŸàÿπÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ® */
            .students-subscriptions-list,
            .students-payments-list {
                width: 100%;
            }

            .student-subscriptions-section,
            .student-payments-section {
                margin-bottom: 40px;
                background: white;
                border-radius: var(--radius-md);
                padding: 25px;
                box-shadow: var(--shadow-light);
                border: 1px solid var(--border);
            }

            .student-subscriptions-section h3,
            .student-payments-section h3 {
                color: var(--primary);
                margin-bottom: 20px;
                padding-bottom: 10px;
                border-bottom: 2px solid var(--primary-light);
                font-size: 1.4rem;
                font-weight: 700;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .student-subscriptions-section h3::before {
                content: 'üìã';
            }

            .student-payments-section h3::before {
                content: 'üí∞';
            }

            .student-subscriptions-section table,
            .student-payments-section table {
                width: 100%;
                margin-top: 15px;
                border-collapse: collapse;
                border-radius: var(--radius-sm);
                overflow: hidden;
                box-shadow: var(--shadow-light);
            }

            .student-subscriptions-section th,
            .student-subscriptions-section td,
            .student-payments-section th,
            .student-payments-section td {
                padding: 15px 12px;
                text-align: right;
                border: 1px solid var(--border);
            }

            .student-subscriptions-section th,
            .student-payments-section th {
                background: linear-gradient(135deg, var(--primary-light), #fed7aa);
                font-weight: 700;
                color: var(--dark);
                font-size: 1rem;
            }

            .student-subscriptions-section tr:hover,
            .student-payments-section tr:hover {
                background: rgba(249, 115, 22, 0.08);
                transform: scale(1.01);
            }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿßÿ≥ÿ™ÿ¨ÿßÿ®ÿ© ŸÑŸÑÿ¥ÿßÿ¥ÿßÿ™ ÿßŸÑÿµÿ∫Ÿäÿ±ÿ© */
    @media (max-width: 768px) {
        /* Ensure toggle button is visible and above other elements */
        #menuToggle {
            display: flex !important;
            align-items: center;
            justify-content: center;
            opacity: 1 !important;
            visibility: visible !important;
            z-index: 1102; /* above overlay and sidebar */
            position: relative;
            margin-right: 10px;
        }

        /* Off-canvas sidebar that slides from the right (RTL) */
        .sidebar {
            right: 0; /* anchor to right for RTL */
            left: auto;
            transform: translateX(100%); /* hidden by default (moved outside viewport to the right) */
            transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1100;
            width: 100%;
            max-width: 320px;
            height: 100vh;
            display: block; /* keep in flow but off-canvas */
        }

        /* When active, bring it into view */
        .sidebar.active {
            transform: translateX(0);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        /* Simple overlay to dim the page and capture outside clicks */
        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.45);
            z-index: 1098;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.25s ease, visibility 0.25s ease;
        }
        .overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .main-content {
            margin-right: 0;
            transition: filter 0.35s ease;
        }

        /* When sidebar open blur the main content but keep the toggle clickable */
        .overlay.active ~ .main-content,
        .sidebar.active ~ .main-content {
            filter: blur(3px);
        }

        /* Layout adjustments for small screens */
        .stats {
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .charts {
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .header {
            padding: 0 12px;
        }

        .header-title h1 {
            font-size: 1.4rem;
        }

        .content {
            padding: 16px 12px;
        }

        .modal-content {
            width: 98%;
            margin: 5% auto;
        }

        .modal-header,
        .modal-body,
        .modal-footer {
            padding: 16px;
        }

        .search-filter {
            flex-direction: column;
            gap: 12px;
        }

        .search-box,
        .filter-box {
            min-width: 100%;
        }

        /* keep header above blurred content but below menuToggle */
        .header {
            position: relative;
            z-index: 100;
        }

    }


            @media (max-width: 992px) {
                .charts {
                    grid-template-columns: 1fr;
                }

                .stats {
                    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                }
            }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÑŸÑÿ™ŸÅÿßÿπŸÑ */
            .stat-card:active {
                transform: translateY(-5px) scale(0.98);
            }

            .btn:active {
                transform: translateY(-1px) scale(0.98);
            }

            .nav-link:active {
                transform: translateX(-8px) scale(0.98);
            }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± */
            ::-webkit-scrollbar {
                width: 8px;
            }

            ::-webkit-scrollbar-track {
                background: var(--gray-light);
            }

            ::-webkit-scrollbar-thumb {
                background: linear-gradient(180deg, var(--primary), var(--primary-dark));
                border-radius: 4px;
            }

            ::-webkit-scrollbar-thumb:hover {
                background: linear-gradient(180deg, var(--primary-dark), #c2410c);
            }

            /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ™ÿ≠ÿ±ŸäŸÉ ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ© */
            @keyframes fadeInUp {
                from {
                    opacity: 0;
                    transform: translateY(30px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            @keyframes fadeInLeft {
                from {
                    opacity: 0;
                    transform: translateX(-30px);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }

            .stat-card {
                animation: fadeInUp 0.6s ease-out forwards;
            }

            .stat-card:nth-child(1) { animation-delay: 0.1s; }
            .stat-card:nth-child(2) { animation-delay: 0.2s; }
            .stat-card:nth-child(3) { animation-delay: 0.3s; }
            .stat-card:nth-child(4) { animation-delay: 0.4s; }

            .nav-link {
                animation: fadeInLeft 0.6s ease-out forwards;
            }

            .nav-link:nth-child(1) { animation-delay: 0.1s; }
            .nav-link:nth-child(2) { animation-delay: 0.2s; }
            .nav-link:nth-child(3) { animation-delay: 0.3s; }
            .nav-link:nth-child(4) { animation-delay: 0.4s; }
            .nav-link:nth-child(5) { animation-delay: 0.5s; }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ ŸÑŸÑŸàÿµŸàŸÑŸäÿ© */
            .btn:focus,
            .nav-link:focus,
            input:focus,
            select:focus,
            textarea:focus {
                outline: 3px solid rgba(249, 115, 22, 0.5);
                outline-offset: 2px;
            }

            /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ∑ÿ®ÿßÿπÿ© */
            @media print {
                .sidebar,
                .header,
                .btn,
                .action-buttons {
                    display: none !important;
                }

                .main-content {
                    margin-right: 0 !important;
                }

                .stat-card,
                .chart-container,
                .recent-activity,
                .table-container {
                    box-shadow: none !important;
                    border: 1px solid #ccc !important;
                }
            }
        </style>

        
    <style>
    /* ===== Mobile Sidebar ===== */
    @media (max-width: 768px) {
    #sidebar {
        position: fixed;
        left: -250px;
        top: 0;
        width: 250px;
        height: 100%;
        background: #1f2937;
        transition: left 0.3s ease;
        z-index: 1000;
    }
    #sidebar.active {
        left: 0;
    }
    #content {
        padding-left: 0;
    }
    #sidebar-toggle {
        display: inline-block;
        cursor: pointer;
        padding: 10px;
        color: white;
        background: #111827;
    }
    }
    .user-avatar {
    border-radius: 50%;
    width: 50px;
    height: 50px;
    }
    .profile-section {
    padding: 20px;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .profile-section img {
    border-radius: 50%;
    width: 100px;
    height: 100px;
    object-fit: cover;
    }
    </style>

    </head>
    <body>
        <!-- Sidebar -->
        <div class="sidebar" id="appSidebar">
            <div class="sidebar-header">
            <img class="logo" src="./logo2.jpg" alt="">
                <h3> Assiut Academy </h3>
            </div>
            <ul class="sidebar-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" onclick="switchTab('dashboard'); setActiveLink(this);">
                        <i class="fas fa-home"></i>
                        <span>ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="switchTab('students'); setActiveLink(this);">
                        <i class="fas fa-users"></i>
                        <span>ÿßŸÑÿ∑ŸÑÿßÿ®</span>
                    </a>
                </li>
                <li class="nav-item">
        <a href="#" class="nav-link" onclick="switchTab('parents'); setActiveLink(this);">
            <i class="fas fa-user-friends"></i> <!-- Icon for Parents -->
            <span>ÿ£ŸàŸÑŸäÿßÿ° ÿßŸÑÿ£ŸÖŸàÿ±</span>
        </a>
    </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="switchTab('courses'); setActiveLink(this);">
                        <i class="fas fa-book"></i>
                        <span>ÿßŸÑŸÉŸàÿ±ÿ≥ÿßÿ™</span>
                    </a>
                </li>
                <li class="nav-item">
        <a href="#" class="nav-link" onclick="switchTab('teacherExams'); setActiveLink(this);">
            <i class="fas fa-file-alt"></i>
            <span>ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑŸÖÿπŸÑŸÖŸäŸÜ</span>
        </a>
    </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="switchTab('subscriptions'); setActiveLink(this);">
                        <i class="fas fa-file-contract"></i>
                        <span>ÿßŸÑÿßÿ¥ÿ™ÿ±ÿßŸÉÿßÿ™</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="switchTab('payments'); setActiveLink(this);">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>ÿßŸÑŸÖÿØŸÅŸàÿπÿßÿ™</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="switchTab('attendances'); setActiveLink(this);">
                        <i class="fas fa-calendar-check"></i>
                        <span>ÿßŸÑÿ≠ÿ∂Ÿàÿ±</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- Overlay for mobile when sidebar is open -->
        <div class="overlay" id="sidebarOverlay" aria-hidden="true"></div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div class="header-title">
                    <h1>ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ</h1>
                </div>
                <button id="menuToggle" type="button" class="menu-toggle-btn">
    <i class="fas fa-bars"></i>
    </button>

                <div class="user-info">
                    <span id="userName">ÿßŸÑÿ≥ŸÉÿ±ÿ™Ÿäÿ±</span>
                    <i class="fas fa-user-circle fa-2x"></i>
                </div>
            </div>

    <!-- secretary attendance UI moved into Attendances tab (mobile-friendly) -->


            <!-- Content -->
            <div class="content">
                <!-- Dashboard Tab -->
                <div id="dashboardContent" class="tab-content" style="display: block;">
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-icon bg-primary">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-text">
                                <h3 id="totalStudents">0</h3>
                                <p>ÿπÿØÿØ ÿßŸÑÿ∑ŸÑÿßÿ®</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon bg-success">
                                <i class="fas fa-book"></i>
                            </div>
                            <div class="stat-text">
                                <h3 id="totalCourses">0</h3>
                                <p>ÿπÿØÿØ ÿßŸÑŸÉŸàÿ±ÿ≥ÿßÿ™</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon bg-warning">
                                <i class="fas fa-file-contract"></i>
                            </div>
                            <div class="stat-text">
                                <h3 id="totalSubscriptions">0</h3>
                                <p>ÿπÿØÿØ ÿßŸÑÿßÿ¥ÿ™ÿ±ÿßŸÉÿßÿ™</p>
                            </div>
                        </div>
    <div class="stat-card">
        <div class="stat-icon bg-info">
            <i class="fas fa-user-check"></i>
        </div>
        <div class="stat-text">
            <h3 id="totalRevenue">0</h3>
            <p>ÿπÿØÿØ ÿßŸÑÿ≠ÿßÿ∂ÿ±ŸäŸÜ ÿßŸÑŸäŸàŸÖ</p>
        </div>
    </div>
                    </div>

                    <div class="charts">
                        <div class="chart-container">
                            <h2>ÿßŸÑÿ•Ÿäÿ±ÿßÿØÿßÿ™ ÿßŸÑÿ¥Ÿáÿ±Ÿäÿ©</h2>
                            <canvas id="revenueChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <h2>ÿ™Ÿàÿ≤Ÿäÿπ ÿßŸÑÿ∑ŸÑÿßÿ® ÿ≠ÿ≥ÿ® ÿßŸÑŸÉŸàÿ±ÿ≥ÿßÿ™</h2>
                            <canvas id="studentsChart"></canvas>
                        </div>
                    </div>

                    <div class="recent-activity">
                        <h2>ÿ¢ÿÆÿ± ÿßŸÑÿ£ŸÜÿ¥ÿ∑ÿ©</h2>
                        <ul class="activity-list" id="activityList">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                <p>ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿ¢ÿÆÿ± ÿßŸÑÿ£ŸÜÿ¥ÿ∑ÿ©...</p>
                            </div>
                        </ul>
                    </div>
                </div>


                
                <!-- Students Tab -->
                <div id="studentsContent" class="tab-content" style="display: none;">
                    <div class="search-filter">
                        <div class="search-box">
                            <input type="text" id="studentSearch" placeholder="ÿ®ÿ≠ÿ´ ÿπŸÜ ÿ∑ÿßŸÑÿ®..." onkeyup="filterStudents()">
                        </div>
                    </div>
                    <div id="studentsContainer">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <p>ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®...</p>
                        </div>
                    </div>
                </div>

    <!-- Parents Tab -->
    <div id="parentsContent" class="tab-content" style="display: none;">
            <h2 style="margin-bottom: 20px; color: var(--primary, #f97316); font-weight: 700; font-size: 1.6rem; text-align: center;">ÿ•ÿ±ÿ≥ÿßŸÑ ÿ™ŸÇÿ±Ÿäÿ± ŸÑŸÑÿ∑ŸÑÿßÿ® ÿπÿ®ÿ± ÿßŸÑŸàÿßÿ™ÿ≥ÿßÿ®</h2>
        <div class="search-filter">
            <div class="search-box">
                <input type="text" id="parentSearch" placeholder="ÿ®ÿ≠ÿ´ ÿπŸÜ ÿ∑ÿßŸÑÿ®..." onkeyup="filterParents()">
            </div>
        </div>
        <div id="parentsStudentsContainer">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®...</p>
            </div>
        </div>
    </div>

    <!-- Courses Tab -->
    <div id="coursesContent" class="tab-content" style="display: none;">
        <div class="search-filter">
            <div class="search-box">
                <input type="text" id="courseSearch" placeholder="ÿ®ÿ≠ÿ´ ÿπŸÜ ŸÉŸàÿ±ÿ≥..." onkeyup="filterCourses()">
            </div>
        </div>
        <div id="coursesContainer">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÉŸàÿ±ÿ≥ÿßÿ™...</p>
            </div>
        </div>
    </div>

    <div id="teacherExamsContent" class="tab-content" style="display:none;">
    <h2 style="margin-bottom: 20px; color: var(--primary, #f97316); font-weight: 700; font-size: 1.6rem; text-align: center;">üìö ŸÇÿßÿ¶ŸÖÿ© ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑŸÖÿπŸÑŸÖŸäŸÜ</h2>  <input type="text" id="teacherExamSearch" placeholder="üîç ÿßÿ®ÿ≠ÿ´ ÿ®ÿßÿ≥ŸÖ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± ÿ£Ÿà ÿßŸÑŸÉŸàÿ±ÿ≥" style="padding:8px; margin-bottom:15px; width:100%; max-width:300px;">
    <div id="teacherExamsContainer"></div>
    </div>
    <!-- Course Detail Modal (ŸäŸèÿπÿ±ÿ∂ ÿπŸÜÿØ ÿßŸÑŸÜŸÇÿ± ÿπŸÑŸâ ŸÉŸàÿ±ÿ≥) -->
    <div id="courseDetailModal" class="modal">
        <div class="modal-content modal-lg"> <!-- ÿßÿ≥ÿ™ÿÆÿØŸÖ modal-lg ŸÑŸÑÿπÿ±ÿ∂ ÿßŸÑÿ£ŸÉÿ®ÿ± -->
            <div class="modal-header">
                <h2 id="courseDetailTitle">ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÉŸàÿ±ÿ≥</h2>
                <button class="close" onclick="closeModal('courseDetailModal')">&times;</button>
            </div>
            <div class="modal-body">
                <!-- ÿπŸÑÿßŸÖÿßÿ™ ÿßŸÑÿ™ÿ®ŸàŸäÿ® ÿØÿßÿÆŸÑ ŸÜÿßŸÅÿ∞ÿ© ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÉŸàÿ±ÿ≥ -->
                <div class="course-detail-tabs">
                    <button class="tab-button active" onclick="switchCourseDetailTab('overview')">ŸÜÿ∏ÿ±ÿ© ÿπÿßŸÖÿ©</button>
                    <button class="tab-button" onclick="switchCourseDetailTab('modules')">ÿßŸÑŸàÿ≠ÿØÿßÿ™ ŸàÿßŸÑÿØÿ±Ÿàÿ≥</button>
                    <!-- ŸäŸÖŸÉŸÜŸÉ ÿ•ÿ∂ÿßŸÅÿ© ÿπŸÑÿßŸÖÿßÿ™ ÿ™ÿ®ŸàŸäÿ® ÿ£ÿÆÿ±Ÿâ ÿ≠ÿ≥ÿ® ÿßŸÑÿ≠ÿßÿ¨ÿ© -->
                </div>

                <!-- ŸÖÿ≠ÿ™ŸàŸâ ÿ™ÿ®ŸàŸäÿ® "ŸÜÿ∏ÿ±ÿ© ÿπÿßŸÖÿ©" -->
                <div id="courseOverviewTab" class="course-detail-tab-content">
                    <div class="course-detail-info">
                        <p><strong>ÿßŸÑÿßÿ≥ŸÖ:</strong> <span id="detailCourseName"></span></p>
                        <p><strong>ÿßŸÑŸàÿµŸÅ:</strong> <span id="detailCourseDescription"></span></p>
                        <p><strong>ÿßŸÑÿ≥ÿπÿ±:</strong> <span id="detailCoursePrice"></span> ÿ¨.ŸÖ</p>
                        <p><strong>ÿßŸÑŸÖÿπŸÑŸÖ ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ:</strong> <span id="detailCourseTeacher"></span></p>
                        <p><strong>ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ®ÿØÿßŸäÿ©:</strong> <span id="detailCourseStartDate"></span></p>
                        <p><strong>ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸÜŸáÿßŸäÿ©:</strong> <span id="detailCourseEndDate"></span></p>
                    </div>
                    <div class="modal-footer" style="margin-top: 20px;">
                        <button class="btn btn-secondary" onclick="showEditCourseModal(getCurrentCourseIdFromDetail())">ÿ™ÿπÿØŸäŸÑ</button>
                        <button class="btn btn-danger" onclick="deleteCourse(getCurrentCourseIdFromDetail())">ÿ≠ÿ∞ŸÅ</button>
                        <button class="btn btn-outline" onclick="closeModal('courseDetailModal')">ÿ•ÿ∫ŸÑÿßŸÇ</button>
                    </div>
                </div>

                <!-- ŸÖÿ≠ÿ™ŸàŸâ ÿ™ÿ®ŸàŸäÿ® "ÿßŸÑŸàÿ≠ÿØÿßÿ™ ŸàÿßŸÑÿØÿ±Ÿàÿ≥" -->
                <div id="courseModulesTab" class="course-detail-tab-content" style="display:none;">
                    <div class="modules-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3>ÿßŸÑŸàÿ≠ÿØÿßÿ™</h3>
                            <button class="btn btn-primary" onclick="openAddModuleModal()">ÿ•ÿ∂ÿßŸÅÿ© Ÿàÿ≠ÿØÿ©</button>
                        </div>
                        <div id="modulesList">
                            <!-- ÿ≥Ÿäÿ™ŸÖ ÿ™ÿπÿ®ÿ¶ÿ© ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿ®Ÿàÿßÿ≥ÿ∑ÿ© JavaScript -->
                            <p class="no-data">ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸàÿ≠ÿØÿßÿ™...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal ÿ•ÿ∂ÿßŸÅÿ©/ÿ™ÿπÿØŸäŸÑ Ÿàÿ≠ÿØÿ© -->
    <div id="moduleModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('moduleModal')">&times;</span>
            <h2 id="moduleModalTitle">ÿ•ÿ∂ÿßŸÅÿ© Ÿàÿ≠ÿØÿ© ÿ¨ÿØŸäÿØÿ©</h2>
            <form id="moduleForm">
                <input type="hidden" id="moduleId">
                <div class="form-group">
                    <label for="moduleTitle">ÿßÿ≥ŸÖ ÿßŸÑŸàÿ≠ÿØÿ©:</label>
                    <input type="text" id="moduleTitle" required>
                </div>
                <div class="form-group">
                    <label for="moduleDescription">ŸàÿµŸÅ ÿßŸÑŸàÿ≠ÿØÿ©:</label>
                    <textarea id="moduleDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="moduleOrder">ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸàÿ≠ÿØÿ©:</label>
                    <input type="number" id="moduleOrder" min="1">
                </div>
                <button type="submit" class="btn btn-primary">ÿ≠ŸÅÿ∏</button>
            </form>
        </div>
    </div>

    <!-- Modal ÿ•ÿ∂ÿßŸÅÿ©/ÿ™ÿπÿØŸäŸÑ ÿØÿ±ÿ≥ -->
    <div id="lessonModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('lessonModal')">&times;</span>
            <h2 id="lessonModalTitle">ÿ•ÿ∂ÿßŸÅÿ© ÿØÿ±ÿ≥ ÿ¨ÿØŸäÿØ</h2>
            <form id="lessonForm">
                <input type="hidden" id="lessonId">
                <input type="hidden" id="lessonModuleId"> <!-- ŸÑÿ™ÿÆÿ≤ŸäŸÜ module_id -->
                <div class="form-group">
                    <label for="lessonTitle">ÿπŸÜŸàÿßŸÜ ÿßŸÑÿØÿ±ÿ≥:</label>
                    <input type="text" id="lessonTitle" required>
                </div>
                <div class="form-group">
                    <label for="lessonDescription">ŸàÿµŸÅ ÿßŸÑÿØÿ±ÿ≥:</label>
                    <textarea id="lessonDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="lessonDate">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿØÿ±ÿ≥:</label>
                    <input type="date" id="lessonDate">
                </div>
                <button type="submit" class="btn btn-primary">ÿ≠ŸÅÿ∏</button>
            </form>
        </div>
    </div>
                <!-- Subscriptions Tab -->
                <div id="subscriptionsContent" class="tab-content" style="display: none;">
                    <div class="search-filter">
                        <div class="search-box">
                            <input type="text" id="subscriptionSearch" placeholder="ÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑÿßÿ¥ÿ™ÿ±ÿßŸÉÿßÿ™..." onkeyup="filterSubscriptions()">
                        </div>
                    </div>
                    <div id="subscriptionsContainer">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <p>ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿßÿ¥ÿ™ÿ±ÿßŸÉÿßÿ™...</p>
                        </div>
                    </div>
                </div>

                <!-- Payments Tab -->
                <div id="paymentsContent" class="tab-content" style="display: none;">
                    <div class="search-filter">
                        <div class="search-box">
                            <input type="text" id="paymentSearch" placeholder="ÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑŸÖÿØŸÅŸàÿπÿßÿ™..." onkeyup="filterPayments()">
                        </div>
                    </div>
                    <div id="paymentsContainer">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <p>ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿØŸÅŸàÿπÿßÿ™...</p>
                        </div>
                    </div>
                </div>

                <!-- Attendances Tab -->
                            <div id="attendancesContent" class="tab-content" style="display: none;">
                    <div class="search-filter">
                        <div class="search-box">
                            <input type="text" id="attendanceSearch" placeholder="ÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑÿ≠ÿ∂Ÿàÿ±..." onkeyup="filterAttendances()">
                        </div>
                    </div>
                                                                    <!-- Secretary attendance box: compact with show-log and check in/out buttons -->
                                                                    <div class="card" id="secretaryPanel" style="    margin-bottom: 18px;
        display: flex
    ;
        justify-content: space-between;
        align-items: center;
        padding: 12px;
        border: 10px solid var(--warning);    color: var(--primary);">
                                                                        <div>
                                                                            <h3 style="margin:0 0 6px 0;">ÿ≠ÿ∂Ÿàÿ± ŸàÿßŸÜÿµÿ±ÿßŸÅ ÿßŸÑÿ≥ŸÉÿ±ÿ™Ÿäÿ±</h3>
                                                                            <p id="secretaryStatus" style="margin:0;color:var(--gray);font-size:0.95rem;">ÿ¨ÿßÿ±Ÿç ÿßŸÑÿ™ÿ≠ŸÇŸÇ...</p>
                                                                            <div style="margin-top: 8px;
        display: flex
    ;
        gap: 8px;
        margin-left: 20px;">
                                                                                <button id="secCheckIn" class="btn btn-success">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ≠ÿ∂Ÿàÿ±</button>
                                                                                <button id="secCheckOut" class="btn btn-danger">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿßŸÜÿµÿ±ÿßŸÅ</button>
                                                                            </div>
                                                                        </div>
                                                                        <div>
                                                                            <button style="top: 40px;" id="secShowLog" class="btn btn-primary">ÿπÿ±ÿ∂ ÿßŸÑÿ≥ÿ¨ŸÑ</button>
                                                                        </div>
                                                                    </div>
                                                                    <div id="secretaryLogWrapper" style="display:none;margin-bottom:12px;">
                                                                        <div id="secretaryLog"></div>
                                                                    </div>

                                    <div style="  border: 10px solid var(--warning);
        color: var(--primary);" id="attendancesContainer">
                                            <div class="loading">
                                                    <div class="loading-spinner"></div>
                                                    <p>ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ≠ÿ∂Ÿàÿ±...</p>
                                            </div>
                                    </div>
                </div>
            </div>
        </div>

        <!-- Status Message -->
        <div id="status"></div>

    <!-- Student Modal -->
    <div id="studentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="studentModalTitle">ÿ•ÿ∂ÿßŸÅÿ© ÿ∑ÿßŸÑÿ® ÿ¨ÿØŸäÿØ</h2>
                <button class="close" onclick="closeModal('studentModal')">&times;</button>
            </div>
            <form id="studentForm">
                <div class="modal-body">
                    <input type="hidden" id="studentId">
                    <div class="form-group">
                        <label for="fullName">ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÉÿßŸÖŸÑ</label>
                        <input type="text" id="fullName" required>
                    </div>
                    <div class="form-group">
                        <label for="email">ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä</label>
                        <input type="email" id="email">
                    </div>
                    <div class="form-group">
                        <label for="phone">ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ</label>
                        <input type="text" id="phone">
                    </div>
                    <!-- ÿ®ÿØÿßŸäÿ© ÿ•ÿ∂ÿßŸÅÿ© ÿ≠ŸÇŸÑ ÿ±ŸÇŸÖ ŸàŸÑŸä ÿßŸÑÿ£ŸÖÿ± -->
                    <div class="form-group">
                        <label for="parentPhone">ÿ±ŸÇŸÖ Ÿáÿßÿ™ŸÅ ŸàŸÑŸä ÿßŸÑÿ£ŸÖÿ±</label>
                        <input type="text" id="parentPhone">
                    </div>
                    <!-- ŸÜŸáÿßŸäÿ© ÿ•ÿ∂ÿßŸÅÿ© ÿ≠ŸÇŸÑ ÿ±ŸÇŸÖ ŸàŸÑŸä ÿßŸÑÿ£ŸÖÿ± -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('studentModal')">ÿ•ŸÑÿ∫ÿßÿ°</button>
                    <button type="submit" class="btn btn-primary">ÿ≠ŸÅÿ∏</button>
                </div>
            </form>
        </div>
    </div>

        <!-- Course Modal -->
        <div id="courseModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="courseModalTitle">ÿ•ÿ∂ÿßŸÅÿ© ŸÉŸàÿ±ÿ≥ ÿ¨ÿØŸäÿØ</h2>
                    <button class="close" onclick="closeModal('courseModal')">&times;</button>
                </div>
                <form id="courseForm">
                    <div class="modal-body">
                        <input type="hidden" id="courseId">
                        <div class="form-group">
                            <label for="courseName">ÿßÿ≥ŸÖ ÿßŸÑŸÉŸàÿ±ÿ≥</label>
                            <input type="text" id="courseName" required>
                        </div>
                        <div class="form-group">
                            <label for="courseDescription">ÿßŸÑŸàÿµŸÅ</label>
                            <textarea id="courseDescription" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="coursePrice">ÿßŸÑÿ≥ÿπÿ± (ÿ¨.ŸÖ)</label>
                            <input type="number" id="coursePrice" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="teacher">ÿßŸÑŸÖÿπŸÑŸÖ ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ</label>
                            <select id="teacher" required>
                                <option value="">ÿßÿÆÿ™ÿ± ŸÖÿπŸÑŸÖÿßŸã</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="startDate">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ®ÿØÿßŸäÿ©</label>
                            <input type="date" id="startDate">
                        </div>
                        <div class="form-group">
                            <label for="endDate">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸÜŸáÿßŸäÿ©</label>
                            <input type="date" id="endDate">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('courseModal')">ÿ•ŸÑÿ∫ÿßÿ°</button>
                        <button type="submit" class="btn btn-primary">ÿ≠ŸÅÿ∏</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Subscription Modal -->
        <div id="subscriptionModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="subscriptionModalTitle">ÿ•ÿ∂ÿßŸÅÿ© ÿßÿ¥ÿ™ÿ±ÿßŸÉ ÿ¨ÿØŸäÿØ</h2>
                    <button class="close" onclick="closeModal('subscriptionModal')">&times;</button>
                </div>
                <form id="subscriptionForm">
                    <div class="modal-body">
                        <input type="hidden" id="subscriptionId">
                        <div class="form-group">
                            <label for="student">ÿßŸÑÿ∑ÿßŸÑÿ®</label>
                            <select id="student" required>
                                <option value="">ÿßÿÆÿ™ÿ± ÿ∑ÿßŸÑÿ®ÿßŸã</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="course">ÿßŸÑŸÉŸàÿ±ÿ≥</label>
                            <select id="course" required>
                                <option value="">ÿßÿÆÿ™ÿ± ŸÉŸàÿ±ÿ≥ÿßŸã</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="subscriptionDate">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿßÿ¥ÿ™ÿ±ÿßŸÉ</label>
                            <input type="date" id="subscriptionDate" required>
                        </div>
                        <div class="form-group">
                            <label for="subscriptionStatus">ÿßŸÑÿ≠ÿßŸÑÿ©</label>
                            <select id="subscriptionStatus" required>
                                <option value="active">ŸÜÿ¥ÿ∑</option>
                                <option value="inactive">ÿ∫Ÿäÿ± ŸÜÿ¥ÿ∑</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="subscriptionNotes">ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™</label>
                            <textarea id="subscriptionNotes" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('subscriptionModal')">ÿ•ŸÑÿ∫ÿßÿ°</button>
                        <button type="submit" class="btn btn-primary">ÿ≠ŸÅÿ∏</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Payment Modal -->
        <div id="paymentModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="paymentModalTitle">ÿ•ÿ∂ÿßŸÅÿ© ÿØŸÅÿπÿ© ÿ¨ÿØŸäÿØÿ©</h2>
                    <button class="close" onclick="closeModal('paymentModal')">&times;</button>
                </div>
                <form id="paymentForm">
                    <div class="modal-body">
                        <input type="hidden" id="paymentId">
                        <div class="form-group">
                            <label for="paymentStudent">ÿßŸÑÿ∑ÿßŸÑÿ®</label>
                            <select id="paymentStudent" required>
                                <option value="">ÿßÿÆÿ™ÿ± ÿ∑ÿßŸÑÿ®ÿßŸã</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="paymentCourse">ÿßŸÑŸÉŸàÿ±ÿ≥</label>
                            <select id="paymentCourse" required>
                                <option value="">ÿßÿÆÿ™ÿ± ŸÉŸàÿ±ÿ≥ÿßŸã</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="amount">ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑŸÖÿØŸÅŸàÿπ (ÿ¨.ŸÖ)</label>
                            <input type="number" id="amount" step="0.01" required>
                        </div>
                            <div class="form-group">
                            <label for="remainingAmount">ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑŸÖÿ™ÿ®ŸÇŸä (ÿ¨.ŸÖ)</label>
                            <input type="number" id="remainingAmount" step="0.01" readonly style="background-color: #f0f0f0;">
                        </div>
                        <div class="form-group">
                            <label for="totalAmount">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÉŸàÿ±ÿ≥ (ÿ¨.ŸÖ)</label>
                            <input type="number" id="totalAmount" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="paymentMethod">ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿØŸÅÿπ</label>
                            <select id="paymentMethod" required>
                                <option value="cash">ŸÜŸÇÿØÿßŸã</option>
                                <option value="card">ÿ®ÿ∑ÿßŸÇÿ©</option>
                                <option value="transfer">ÿ™ÿ≠ŸàŸäŸÑ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="paymentDate">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿØŸÅÿπ</label>
                            <input type="date" id="paymentDate" required>
                        </div>
                        <div class="form-group">
                            <label for="paymentStatus">ÿßŸÑÿ≠ÿßŸÑÿ©</label>
                            <select id="paymentStatus" required>
                                <option value="paid">ŸÖÿØŸÅŸàÿπ</option>
                                <option value="pending">ŸÖÿπŸÑŸÇ</option>
                                <option value="cancelled">ŸÖŸÑÿ∫Ÿâ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="paymentNotes">ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™</label>
                            <textarea id="paymentNotes" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('paymentModal')">ÿ•ŸÑÿ∫ÿßÿ°</button>
                        <button type="submit" class="btn btn-primary">ÿ≠ŸÅÿ∏</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Attendance Modal -->
        <div id="attendanceModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="attendanceModalTitle">ÿ•ÿ∂ÿßŸÅÿ© ÿ≠ÿ∂Ÿàÿ± ÿ¨ÿØŸäÿØ</h2>
                    <button class="close" onclick="closeModal('attendanceModal')">&times;</button>
                </div>
                <form id="attendanceForm">
                    <div class="modal-body">
                        <input type="hidden" id="attendanceId">
                        <div class="form-group">
                            <label for="attendanceStudent">ÿßŸÑÿ∑ÿßŸÑÿ®</label>
                            <select id="attendanceStudent" required>
                                <option value="">ÿßÿÆÿ™ÿ± ÿ∑ÿßŸÑÿ®ÿßŸã</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="attendanceCourse">ÿßŸÑŸÉŸàÿ±ÿ≥</label>
                            <select id="attendanceCourse" required>
                                <option value="">ÿßÿÆÿ™ÿ± ŸÉŸàÿ±ÿ≥ÿßŸã</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="attendanceDate">ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</label>
                            <input type="date" id="attendanceDate" required>
                        </div>
                        <div class="form-group">
                            <label for="attendanceStatus">ÿßŸÑÿ≠ÿßŸÑÿ©</label>
                            <select id="attendanceStatus" required>
                                <option value="present">ÿ≠ÿßÿ∂ÿ±</option>
                                <option value="absent">ÿ∫ÿßÿ¶ÿ®</option>
                                <option value="late">ŸÖÿ™ÿ£ÿÆÿ±</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="attendanceNotes">ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™</label>
                            <textarea id="attendanceNotes" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('attendanceModal')">ÿ•ŸÑÿ∫ÿßÿ°</button>
                        <button type="submit" class="btn btn-primary">ÿ≠ŸÅÿ∏</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Student Detail Modal -->
        <div id="studentDetailModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ∑ÿßŸÑÿ®</h2>
                    <button class="close" onclick="closeModal('studentDetailModal')">&times;</button>
                </div>
                <div class="modal-body" id="studentDetailContent">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ∑ÿßŸÑÿ®...</p>
                    </div>
                </div>
            </div>
        </div>
    <!-- Payment Receipt Modal -->
        <div id="paymentReceiptModal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header">
                    <h2>ÿ•ŸäÿµÿßŸÑ ÿØŸÅÿπ</h2>
                    <button class="close" onclick="closeModal('paymentReceiptModal')">&times;</button>
                </div>
                <div class="modal-body" id="paymentReceiptContent">
                    <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ° ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿØŸäŸÜÿßŸÖŸäŸÉŸäÿßŸã -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('paymentReceiptModal')">ÿ•ÿ∫ŸÑÿßŸÇ</button>
                    <button class="btn btn-primary" onclick="printPaymentReceipt()">ÿ∑ÿ®ÿßÿπÿ© ÿßŸÑÿ•ŸäÿµÿßŸÑ</button>
                </div>
            </div>
        </div>

        <!-- Attendance Receipt Modal -->
        <div id="attendanceReceiptModal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header">
                    <h2>ÿ•ŸäÿµÿßŸÑ ÿ≠ÿ∂Ÿàÿ±</h2>
                    <button class="close" onclick="closeModal('attendanceReceiptModal')">&times;</button>
                </div>
                <div class="modal-body" id="attendanceReceiptContent">
                    <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ° ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿØŸäŸÜÿßŸÖŸäŸÉŸäÿßŸã -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('attendanceReceiptModal')">ÿ•ÿ∫ŸÑÿßŸÇ</button>
                    <button class="btn btn-primary" onclick="printAttendanceReceipt()">ÿ∑ÿ®ÿßÿπÿ© ÿßŸÑÿ•ŸäÿµÿßŸÑ</button>
                </div>
            </div>
        </div>
        <!-- ŸÜŸÖŸàÿ∞ÿ¨ ÿ•ÿ∂ÿßŸÅÿ©/ÿ™ÿπÿØŸäŸÑ ÿßÿÆÿ™ÿ®ÿßÿ± -->
    <!-- ŸÜŸÖŸàÿ∞ÿ¨ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± -->
    <div id="examModal" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); justify-content: center; align-items: center; direction: rtl;">
    <div class="modal-content" style="
        background: white;
        width: 90%;
        max-width: 500px;
        border-radius: 12px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        overflow: hidden;
        animation: modalFadeIn 0.3s ease-out;
    ">
        <!-- ÿ±ÿ£ÿ≥ ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨ -->
        <div style="background: #007bff; color: white; padding: 15px 20px; text-align: center; font-size: 1.2em; font-weight: 600;">
        <span id="examModalTitle">ÿ•ÿ∂ÿßŸÅÿ© ÿßÿÆÿ™ÿ®ÿßÿ± ÿ¨ÿØŸäÿØ</span>
        </div>

        <!-- ÿ≤ÿ± ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ -->
        <span onclick="closeModal('examModal')" style="
        position: absolute;
        top: 15px;
        left: 20px;
        font-size: 24px;
        color: white;
        cursor: pointer;
        font-weight: bold;
        ">&times;</span>

        <!-- ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨ -->
        <form id="examForm" onsubmit="event.preventDefault(); saveExam();" style="padding: 25px;">
        <input type="hidden" id="examId">

        <!-- ÿπŸÜŸàÿßŸÜ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± -->
        <div style="margin-bottom: 15px;">
            <label for="examTitle" style="display: block; margin-bottom: 6px; font-weight: 600; color: #333;">ÿπŸÜŸàÿßŸÜ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± *</label>
            <input type="text" id="examTitle" required style="
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            background: #f9f9f9;
            ">
        </div>

        <!-- ÿßŸÑŸÉŸàÿ±ÿ≥ -->
        <div style="margin-bottom: 15px;">
            <label for="examCourse" style="display: block; margin-bottom: 6px; font-weight: 600; color: #333;">ÿßÿÆÿ™ÿ± ÿßŸÑŸÉŸàÿ±ÿ≥ *</label>
            <select id="examCourse" required style="
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            background: #f9f9f9;
            ">
            <option value="">ÿßÿÆÿ™ÿ± ŸÉŸàÿ±ÿ≥ÿßŸã</option>
            </select>
        </div>

        <!-- ÿßŸÑŸàÿ≠ÿØÿ© -->
        <div style="margin-bottom: 15px;">
            <label for="examModule" style="display: block; margin-bottom: 6px; font-weight: 600; color: #333;">ÿßÿÆÿ™ÿ± ÿßŸÑŸàÿ≠ÿØÿ© *</label>
            <select id="examModule" required style="
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            background: #f9f9f9;
            ">
            <option value="">ÿßÿÆÿ™ÿ± Ÿàÿ≠ÿØÿ©</option>
            </select>
        </div>

        <!-- ÿßŸÑÿØÿ±ÿ¨ÿ© ÿßŸÑŸÇÿµŸàŸâ -->
        <div style="margin-bottom: 15px;">
            <label for="examMaxScore" style="display: block; margin-bottom: 6px; font-weight: 600; color: #333;">ÿßŸÑÿØÿ±ÿ¨ÿ© ÿßŸÑŸÇÿµŸàŸâ *</label>
            <input type="number" id="examMaxScore" step="0.5" min="1" required style="
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            background: #f9f9f9;
            ">
        </div>

        <!-- ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± -->
        <div style="margin-bottom: 20px;">
            <label for="examDate" style="display: block; margin-bottom: 6px; font-weight: 600; color: #333;">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± *</label>
            <input type="date" id="examDate" required style="
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            background: #f9f9f9;
            ">
        </div>

        <!-- ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™ -->
        <div style="text-align: left; margin-top: 10px;">
            <button type="button" onclick="closeModal('examModal')" style="
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
            ">ÿ•ŸÑÿ∫ÿßÿ°</button>
            <button type="submit" style="
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            ">ÿ≠ŸÅÿ∏</button>
        </div>
        </form>
    </div>
    </div>


    <!-- ÿ£ŸÜŸÖŸäÿ¥ŸÜ ÿØÿÆŸàŸÑ ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨ -->

    </div>
    <script src="./master.js"></script>

    <!-- Small JS to toggle mobile sidebar; placed after master.js to replace conflicting listeners -->
    <script>
        (function(){
            let toggle = document.getElementById('menuToggle');
            const sidebar = document.getElementById('appSidebar');
            const overlay = document.getElementById('sidebarOverlay');
            const navLinks = document.querySelectorAll('.sidebar .nav-link');

            // Replace toggle with a clone to remove any previously attached listeners (master.js may add one)
            if (toggle && toggle.parentNode) {
                const clone = toggle.cloneNode(true);
                toggle.parentNode.replaceChild(clone, toggle);
                toggle = clone; // use the fresh node
            }

            function openSidebar(){
                // add active class for CSS-driven behavior
                sidebar.classList.add('active');
                overlay.classList.add('active');
                overlay.setAttribute('aria-hidden', 'false');
                sidebar.setAttribute('aria-hidden', 'false');

                // ensure visibility even if media queries don't apply
                try {
                    sidebar.style.display = 'block';
                    sidebar.style.transform = 'translateX(0)';
                    sidebar.style.right = '0';
                    overlay.style.display = 'block';
                } catch (e) { /* ignore */ }

                // make sure toggle stays clickable
                toggle.style.zIndex = 1102;
            }
            function closeSidebar(){
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
                overlay.setAttribute('aria-hidden', 'true');
                sidebar.setAttribute('aria-hidden', 'true');

                // reset inline styles so CSS controls layout again
                try {
                    sidebar.style.transform = '';
                    sidebar.style.display = '';
                    overlay.style.display = '';
                } catch (e) { /* ignore */ }

                toggle.style.zIndex = '';
            }

            if (toggle && sidebar && overlay) {
                toggle.addEventListener('click', function(e){
                    e.preventDefault();
                    e.stopPropagation();

                    if (sidebar.classList.contains('active')) {
                        closeSidebar();
                        console.debug('Sidebar closed by inline toggle');
                    } else {
                        openSidebar();
                        console.debug('Sidebar opened by inline toggle');
                    }
                }, { passive: false });

                overlay.addEventListener('click', function(){ closeSidebar(); });

                // close sidebar when clicking any nav link (mobile)
                navLinks.forEach(link => link.addEventListener('click', function(){
                    if (window.innerWidth <= 768) closeSidebar();
                }));

                // close on escape
                document.addEventListener('keydown', function(e){ if (e.key === 'Escape') closeSidebar(); });
            }
        })();
    </script>

    <!-- Small script: make tables responsive by adding data-label attributes to TDs from THs -->
    <script>
        (function(){
            function applyDataLabels(table){
                const headers = Array.from(table.querySelectorAll('thead th')).map(th => th.textContent.trim());
                const rows = table.querySelectorAll('tbody tr');
                rows.forEach(row => {
                    Array.from(row.children).forEach((td, idx) => {
                        if (!td.hasAttribute('data-label') && headers[idx]) {
                            td.setAttribute('data-label', headers[idx]);
                        }
                    });
                });
            }

            function applyAll(){
                document.querySelectorAll('table').forEach(table => applyDataLabels(table));
            }

            // Run on load
            window.addEventListener('load', applyAll);

            // Observe DOM mutations (for tables populated by JS)
            const observer = new MutationObserver((mutations) => {
                let shouldRun = false;
                for (const m of mutations) {
                    if (m.addedNodes && m.addedNodes.length) shouldRun = true;
                }
                if (shouldRun) setTimeout(applyAll, 50);
            });

            observer.observe(document.body, { childList: true, subtree: true });
        })();
    </script>

        <!-- Secretary attendance: render log and wire buttons -->
        <script>
            (function(){
                async function renderSecretaryLog(){
                    const logEl = document.getElementById('secretaryLog');
                    const statusEl = document.getElementById('secretaryStatus');
                    if (!logEl || typeof supabaseClient === 'undefined') return;

                    statusEl.textContent = 'ÿ¨ÿßÿ±Ÿç ÿ™ÿ≠ŸÖŸäŸÑ ÿ≥ÿ¨ŸÑ ÿßŸÑÿ≥ŸÉÿ±ÿ™Ÿäÿ±...';
                    try {
                        const today = new Date().toISOString().split('T')[0];
                        const { data, error } = await supabaseClient
                            .from('secretary_attendance')
                            .select('*')
                            .order('date', { ascending: false })
                            .limit(50);

                        if (error) throw error;

                        if (!data || data.length === 0) {
                            logEl.innerHTML = '<p class="no-data">ŸÑÿß ŸäŸàÿ¨ÿØ ÿ≥ÿ¨ŸÑÿßÿ™ ÿ≠ÿ™Ÿâ ÿßŸÑÿ¢ŸÜ.</p>';
                            statusEl.textContent = 'ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ≠ÿ∂Ÿàÿ± ÿßŸÑŸäŸàŸÖ ÿ®ÿπÿØ.';
                            return;
                        }

                                // Build simple list (nicer cards)
                                logEl.innerHTML = `<div class="secretary-log">${data.map(r => `
                                        <div class="secretary-log-card">
                                            <div class="secretary-log-meta">
                                                <div><strong>ÿßŸÑÿ™ÿßÿ±ŸäÿÆ:</strong> ${r.date}</div>
                                                <div class="secretary-log-time"><strong>ÿØÿÆŸàŸÑ:</strong> ${r.check_in ? new Date(r.check_in).toLocaleTimeString('ar-EG') : '-'}</div>
                                                <div class="secretary-log-time"><strong>ÿÆÿ±Ÿàÿ¨:</strong> ${r.check_out ? new Date(r.check_out).toLocaleTimeString('ar-EG') : '-'}</div>
                                            </div>
                                            <!-- controls removed: 'ÿπÿ±ÿ∂' button eliminated per request -->
                                        </div>
                                `).join('')}</div>`;

                        // Update status with today's record if exists
                        const todayRec = data.find(d => d.date === today);
                        if (todayRec) {
                            statusEl.textContent = `ÿßŸÑŸäŸàŸÖ: ${todayRec.check_in ? 'ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ≠ÿ∂Ÿàÿ±' : 'ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ≠ÿ∂Ÿàÿ±'} ${todayRec.check_out ? ' - ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿßŸÜÿµÿ±ÿßŸÅ' : ''}`;
                        } else {
                            statusEl.textContent = 'ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ≠ÿ∂Ÿàÿ± ÿßŸÑŸäŸàŸÖ ÿ®ÿπÿØ.';
                        }

                    } catch (err) {
                        console.error('Error loading secretary log', err);
                        logEl.innerHTML = '<p class="no-data">ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ≥ÿ¨ŸÑ.</p>';
                        statusEl.textContent = 'ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ≥ŸÉÿ±ÿ™Ÿäÿ±';
                    }
                }

                // helper to call function that might be sync or async
                function callAndRefresh(fn) {
                    try {
                        const res = fn();
                        if (res && typeof res.then === 'function') {
                            res.then(() => setTimeout(renderSecretaryLog, 300)).catch(() => setTimeout(renderSecretaryLog, 600));
                        } else {
                            // not a promise - refresh after small delay
                            setTimeout(renderSecretaryLog, 500);
                        }
                    } catch (err) {
                        console.error('Error calling function', err);
                        setTimeout(renderSecretaryLog, 800);
                    }
                }

                // wire show-log and check-in/out buttons
                document.addEventListener('click', function(e){
                    const btnShow = e.target.closest && e.target.closest('#secShowLog');
                    const btnIn = e.target.closest && e.target.closest('#secCheckIn');
                    const btnOut = e.target.closest && e.target.closest('#secCheckOut');

                    if (btnShow) {
                        const wrapper = document.getElementById('secretaryLogWrapper');
                        if (!wrapper) return;
                        if (wrapper.style.display === 'none' || wrapper.style.display === '') {
                            wrapper.style.display = 'block';
                            renderSecretaryLog();
                            btnShow.textContent = 'ÿ•ÿÆŸÅÿßÿ° ÿßŸÑÿ≥ÿ¨ŸÑ';
                        } else {
                            wrapper.style.display = 'none';
                            btnShow.textContent = 'ÿπÿ±ÿ∂ ÿßŸÑÿ≥ÿ¨ŸÑ';
                        }
                        return;
                    }

                    if (btnIn) {
                        if (typeof checkInSecretary === 'function') callAndRefresh(checkInSecretary);
                        return;
                    }

                    if (btnOut) {
                        if (typeof checkOutSecretary === 'function') callAndRefresh(checkOutSecretary);
                        return;
                    }
                });

                // initial render
                window.addEventListener('load', function(){ setTimeout(renderSecretaryLog, 300); });

                // expose for manual refresh
                window.renderSecretaryLog = renderSecretaryLog;
            })();
        </script>


    </body>
    <!-- WhatsApp preview modal for parents report -->
    <div id="waPreviewModal" class="modal" style="display:none;">
        <div class="modal-content" style="max-width:720px;">
            <div class="modal-header">
                <h3>ŸÖÿπÿßŸäŸÜÿ© ÿ±ÿ≥ÿßŸÑÿ© Ÿàÿßÿ™ÿ≥ÿßÿ®</h3>
                <button class="close-modal" id="waPreviewClose">√ó</button>
            </div>
            <div class="modal-body" style="padding:12px;">
                <p id="waPreviewPhone" style="font-weight:600;margin-bottom:8px;"></p>
                <textarea id="waPreviewMessage" readonly style="width:100%;height:320px;padding:8px;white-space:pre-wrap;overflow:auto;border:1px solid #ddd;border-radius:6px;font-family:inherit;"></textarea>
            </div>
            <div class="modal-footer" style="display:flex;gap:8px;justify-content:flex-end;padding:12px;border-top:1px solid #eee;">
                <button id="waCopyBtn" class="btn btn-secondary">ŸÜÿ≥ÿÆ ÿßŸÑŸÜÿµ</button>
                <button id="waOpenBtn" class="btn btn-primary">ŸÅÿ™ÿ≠ Ÿàÿßÿ™ÿ≥ÿßÿ®</button>
                <button id="waCloseBtn" class="btn">ÿ•ÿ∫ŸÑÿßŸÇ</button>
            </div>
        </div>
        </div>

        <script>
        (function(){
            try {
                const key = 'assiut_academy_refreshed_v1';
                if (!sessionStorage.getItem(key)) {
                    sessionStorage.setItem(key, '1');
                    setTimeout(() => { try { location.reload(); } catch(e){ console.warn('reload failed', e); } }, 200);
                } else {
                    sessionStorage.removeItem(key);
                }
            } catch (err) { console.warn('Auto-refresh script error', err); }
        })();
        </script>

        </html>

    <script>
    (function(){
        // Conservative, low-impact periodic refresher that calls the app's
        // updateCurrentTab() only when the page is visible. Uses a single
        // loop (no multiple timers) and exponential backoff on errors.
        if (window.__assiut_tab_refresher) return; // avoid duplicate installs
        window.__assiut_tab_refresher = true;

        const DEFAULT_INTERVAL = 60 * 1000; // 60s
        const MAX_BACKOFF_STEPS = 5;
        let backoff = 0;
        let currentInterval = DEFAULT_INTERVAL;
        let stopped = false;

        function sleep(ms){ return new Promise(res => setTimeout(res, ms)); }

        async function runOnce() {
            if (document.visibilityState !== 'visible') return;
            if (typeof updateCurrentTab !== 'function') return;
            try {
                await updateCurrentTab();
                // success -> reset backoff
                backoff = 0;
                currentInterval = DEFAULT_INTERVAL;
            } catch (err) {
                console.warn('Periodic updateCurrentTab() failed, backing off', err);
                backoff = Math.min(MAX_BACKOFF_STEPS, backoff + 1);
                currentInterval = Math.min(DEFAULT_INTERVAL * Math.pow(2, backoff), DEFAULT_INTERVAL * Math.pow(2, MAX_BACKOFF_STEPS));
            }
        }

        // Visibility handling: when hidden we skip runs; when visible we wake loop
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') {
                // run immediately when tab becomes visible
                runOnce().catch(() => {});
            }
        });

        // Focus/blur also helpful on some browsers
        window.addEventListener('focus', () => { runOnce().catch(() => {}); });

        // Main loop
        (async function loop(){
            // small initial delay to let page finish startup
            await sleep(1500);
            while(!stopped){
                await runOnce();
                await sleep(currentInterval);
            }
        })();

        // expose control for debugging or adjusting interval at runtime
        window.assiutTabRefresher = {
            stop(){ stopped = true; },
            start(){ if (stopped){ stopped = false; (async function(){ while(!stopped){ await runOnce(); await sleep(currentInterval); } })(); } },
            setIntervalMs(ms){ currentInterval = Math.max(1000, Number(ms) || DEFAULT_INTERVAL); }
        };
    })();
    </script>