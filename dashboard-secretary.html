    <!DOCTYPE html>
    <html lang="ar" dir="rtl">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>لوحة التحكم - السكرتير</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <link rel="stylesheet" href="./cs/secretary.css">

    <link rel="icon" href="/images/logo2.jpg" type="image/jpeg">



    </head>
    <body>

    <!-- Sidebar -->
    <div class="sidebar" id="appSidebar">
            <div class="sidebar-header">
            <img class="logo" src="./logo2.jpg" alt="">
                <h3> Assiut Academy </h3>
            </div>
            <ul class="sidebar-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" onclick="switchTab('dashboard'); setActiveLink(this);">
                        <i class="fas fa-home"></i>
                        <span>الرئيسية</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="switchTab('students'); setActiveLink(this);">
                        <i class="fas fa-users"></i>
                        <span>الطلاب</span>
                    </a>
                </li>
                <li class="nav-item">
        <a href="#" class="nav-link" onclick="switchTab('parents'); setActiveLink(this);">
            <i class="fas fa-user-friends"></i> <!-- Icon for Parents -->
            <span>أولياء الأمور</span>
        </a>
    </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="switchTab('courses'); setActiveLink(this);">
                        <i class="fas fa-book"></i>
                        <span>الكورسات</span>
                    </a>
                </li>
                <li class="nav-item">
        <a href="#" class="nav-link" onclick="switchTab('teacherExams'); setActiveLink(this);">
            <i class="fas fa-file-alt"></i>
            <span>اختبارات المعلمين</span>
        </a>
    </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="switchTab('subscriptions'); setActiveLink(this);">
                        <i class="fas fa-file-contract"></i>
                        <span>الاشتراكات</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="switchTab('payments'); setActiveLink(this);">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>المدفوعات</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="switchTab('attendances'); setActiveLink(this);">
                        <i class="fas fa-calendar-check"></i>
                        <span>الحضور</span>
                    </a>
                </li>
    <li class="nav-item">
    <a class="nav-link" href="#" onclick="switchTab('dataManagement')">إدارة البيانات</a>
    </li>
                
            </ul>
    </div>

    <!-- Overlay for mobile when sidebar is open -->
    <div class="overlay" id="sidebarOverlay" aria-hidden="true"></div>

    <!-- Main Content -->
    <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div class="header-title">
                    <h1>لوحة التحكم</h1>
                </div>
                <button id="menuToggle" type="button" class="menu-toggle-btn">
    <i class="fas fa-bars"></i>
    </button>

                <div class="user-info">
                    <span id="userName">السكرتير</span>
                    <i class="fas fa-user-circle fa-2x"></i>
                </div>
            </div>

    <!-- secretary attendance UI moved into Attendances tab (mobile-friendly) -->


            <!-- Content -->
            <div class="content">
                <!-- Dashboard Tab -->
                <div id="dashboardContent" class="tab-content" style="display: block;">
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-icon bg-primary">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-text">
                                <h3 id="totalStudents">0</h3>
                                <p>عدد الطلاب</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon bg-success">
                                <i class="fas fa-book"></i>
                            </div>
                            <div class="stat-text">
                                <h3 id="totalCourses">0</h3>
                                <p>عدد الكورسات</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon bg-warning">
                                <i class="fas fa-file-contract"></i>
                            </div>
                            <div class="stat-text">
                                <h3 id="totalSubscriptions">0</h3>
                                <p>عدد الاشتراكات</p>
                            </div>
                        </div>
    <div class="stat-card">
        <div class="stat-icon bg-info">
            <i class="fas fa-user-check"></i>
        </div>
        <div class="stat-text">
            <h3 id="totalRevenue">0</h3>
            <p>عدد الحاضرين اليوم</p>
        </div>
    </div>
                    </div>

                    <div class="charts">
                        <div class="chart-container">
                            <h2>الإيرادات الشهرية</h2>
                            <canvas id="revenueChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <h2>توزيع الطلاب حسب الكورسات</h2>
                            <canvas id="studentsChart"></canvas>
                        </div>
                    </div>

                    <div class="recent-activity">
                        <h2>آخر الأنشطة</h2>
                        <ul class="activity-list" id="activityList">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                <p>جاري تحميل آخر الأنشطة...</p>
                            </div>
                        </ul>
                    </div>
                </div>


    <div id="dataManagementContent" class="tab-content data-management" style="display:none;">
    <div class="section-header">
    <h2>إدارة البيانات</h2>
    <p>متابعة حجم البيانات وعدد الصفوف مع مؤشرات استخدام.</p>
    </div>
    <div id="summaryStats" class="summary-grid"></div>
    <div id="statsContainer" class="stats-grid"></div>
    </div>


                <!-- Students Tab -->
                <div id="studentsContent" class="tab-content" style="display: none;">
                    <div class="search-filter">
                        <div class="search-box">
                            <input type="text" id="studentSearch" placeholder="بحث عن طالب..." onkeyup="filterStudents()">
                        </div>
                    </div>
                    <div id="studentsContainer">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <p>جاري تحميل بيانات الطلاب...</p>
                        </div>
                    </div>
                </div>

    <!-- Parents Tab -->
    <div id="parentsContent" class="tab-content" style="display: none;">
            <h2 style="margin-bottom: 20px; color: var(--primary, #f97316); font-weight: 700; font-size: 1.6rem; text-align: center;">إرسال تقرير للطلاب عبر الواتساب</h2>
        <div class="search-filter">
            <div class="search-box">
                <input type="text" id="parentSearch" placeholder="بحث عن طالب..." onkeyup="filterParents()">
            </div>
        </div>
        <div id="parentsStudentsContainer">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>جاري تحميل بيانات الطلاب...</p>
            </div>
        </div>
    </div>

    <!-- Courses Tab -->
    <div id="coursesContent" class="tab-content" style="display: none;">
        <div class="search-filter">
            <div class="search-box">
                <input type="text" id="courseSearch" placeholder="بحث عن كورس..." onkeyup="filterCourses()">
            </div>
        </div>
        <div id="coursesContainer">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>جاري تحميل بيانات الكورسات...</p>
            </div>
        </div>
    </div>

    <div id="teacherExamsContent" class="tab-content" style="display:none;">
    <h2 style="margin-bottom: 20px; color: var(--primary, #f97316); font-weight: 700; font-size: 1.6rem; text-align: center;">📚 قائمة اختبارات المعلمين</h2>  <input type="text" id="teacherExamSearch" placeholder="🔍 ابحث باسم الاختبار أو الكورس" style="padding:8px; margin-bottom:15px; width:100%; max-width:300px;">
    <div id="teacherExamsContainer"></div>
    </div>
    <!-- Course Detail Modal (يُعرض عند النقر على كورس) -->
    <div id="courseDetailModal" class="modal">
        <div class="modal-content modal-lg"> <!-- استخدم modal-lg للعرض الأكبر -->
            <div class="modal-header">
                <h2 id="courseDetailTitle">تفاصيل الكورس</h2>
                <button class="close" onclick="closeModal('courseDetailModal')">&times;</button>
            </div>
            <div class="modal-body">
                <!-- علامات التبويب داخل نافذة تفاصيل الكورس -->
                <div class="course-detail-tabs">
                    <button class="tab-button active" onclick="switchCourseDetailTab('overview')">نظرة عامة</button>
                    <button class="tab-button" onclick="switchCourseDetailTab('modules')">الوحدات والدروس</button>
                    <!-- يمكنك إضافة علامات تبويب أخرى حسب الحاجة -->
                </div>

                <!-- محتوى تبويب "نظرة عامة" -->
                <div id="courseOverviewTab" class="course-detail-tab-content">
                    <div class="course-detail-info">
                        <p><strong>الاسم:</strong> <span id="detailCourseName"></span></p>
                        <p><strong>الوصف:</strong> <span id="detailCourseDescription"></span></p>
                        <p><strong>السعر:</strong> <span id="detailCoursePrice"></span> ج.م</p>
                        <p><strong>المعلم المسؤول:</strong> <span id="detailCourseTeacher"></span></p>
                        <p><strong>تاريخ البداية:</strong> <span id="detailCourseStartDate"></span></p>
                        <p><strong>تاريخ النهاية:</strong> <span id="detailCourseEndDate"></span></p>
                    </div>
                    <div class="modal-footer" style="margin-top: 20px;">
                        <button class="btn btn-secondary" onclick="showEditCourseModal(getCurrentCourseIdFromDetail())">تعديل</button>
                        <button class="btn btn-danger" onclick="deleteCourse(getCurrentCourseIdFromDetail())">حذف</button>
                        <button class="btn btn-outline" onclick="closeModal('courseDetailModal')">إغلاق</button>
                    </div>
                </div>

                <!-- محتوى تبويب "الوحدات والدروس" -->
                <div id="courseModulesTab" class="course-detail-tab-content" style="display:none;">
                    <div class="modules-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3>الوحدات</h3>
                            <button class="btn btn-primary" onclick="openAddModuleModal()">إضافة وحدة</button>
                        </div>
                        <div id="modulesList">
                            <!-- سيتم تعبئة القائمة بواسطة JavaScript -->
                            <p class="no-data">جاري تحميل الوحدات...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal إضافة/تعديل وحدة -->
    <div id="moduleModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('moduleModal')">&times;</span>
            <h2 id="moduleModalTitle">إضافة وحدة جديدة</h2>
            <form id="moduleForm">
                <input type="hidden" id="moduleId">
                <div class="form-group">
                    <label for="moduleTitle">اسم الوحدة:</label>
                    <input type="text" id="moduleTitle" required>
                </div>
                <div class="form-group">
                    <label for="moduleDescription">وصف الوحدة:</label>
                    <textarea id="moduleDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="moduleOrder">ترتيب الوحدة:</label>
                    <input type="number" id="moduleOrder" min="1">
                </div>
                <button type="submit" class="btn btn-primary">حفظ</button>
            </form>
        </div>
    </div>

    <!-- Modal إضافة/تعديل درس -->
    <div id="lessonModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('lessonModal')">&times;</span>
            <h2 id="lessonModalTitle">إضافة درس جديد</h2>
            <form id="lessonForm">
                <input type="hidden" id="lessonId">
                <input type="hidden" id="lessonModuleId"> <!-- لتخزين module_id -->
                <div class="form-group">
                    <label for="lessonTitle">عنوان الدرس:</label>
                    <input type="text" id="lessonTitle" required>
                </div>
                <div class="form-group">
                    <label for="lessonDescription">وصف الدرس:</label>
                    <textarea id="lessonDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="lessonDate">تاريخ الدرس:</label>
                    <input type="date" id="lessonDate">
                </div>
                <button type="submit" class="btn btn-primary">حفظ</button>
            </form>
        </div>
    </div>
                <!-- Subscriptions Tab -->
                <div id="subscriptionsContent" class="tab-content" style="display: none;">
                    <div class="search-filter">
                        <div class="search-box">
                            <input type="text" id="subscriptionSearch" placeholder="بحث في الاشتراكات..." onkeyup="filterSubscriptions()">
                        </div>
                    </div>
                    <div id="subscriptionsContainer">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <p>جاري تحميل بيانات الاشتراكات...</p>
                        </div>
                    </div>
                </div>

                <!-- Payments Tab -->
                <div id="paymentsContent" class="tab-content" style="display: none;">
                    <div class="search-filter">
                        <div class="search-box">
                            <input type="text" id="paymentSearch" placeholder="بحث في المدفوعات..." onkeyup="filterPayments()">
                        </div>
                    </div>
                    <div id="paymentsContainer">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <p>جاري تحميل بيانات المدفوعات...</p>
                        </div>
                    </div>
                </div>

                <!-- Attendances Tab -->
                            <div id="attendancesContent" class="tab-content" style="display: none;">
                                <button class="btn btn-success" onclick="exportAttendancesExcel()" style="margin-bottom: 20px; margin-right:10px;">
    <i class="fas fa-file-excel"></i> تحميل بيانات الحضور
    </button>

                    <div class="search-filter">
                        <div class="search-box">
                            <input type="text" id="attendanceSearch" placeholder="بحث في الحضور..." onkeyup="filterAttendances()">
                        </div>
                    </div>
                                                                    <!-- Secretary attendance box: compact with show-log and check in/out buttons -->
                                                                    <div class="card" id="secretaryPanel" style="    margin-bottom: 18px;
        display: flex
    ;
        justify-content: space-between;
        align-items: center;
        padding: 12px;
        border: 10px solid var(--warning);    color: var(--primary);">
                                                                        <div>
                                                                            <h3 style="margin:0 0 6px 0;">حضور وانصراف السكرتير</h3>
                                                                            <p id="secretaryStatus" style="margin:0;color:var(--gray);font-size:0.95rem;">جارٍ التحقق...</p>
                                                                            <div style="margin-top: 8px;
        display: flex
    ;
        gap: 8px;
        margin-left: 20px;">
                                                                                <button id="secCheckIn" class="btn btn-success">تسجيل الحضور</button>
                                                                                <button id="secCheckOut" class="btn btn-danger">تسجيل الانصراف</button>
                                                                            </div>
                                                                        </div>
                                                                        <div>
                                                                            <button style="top: 40px;" id="secShowLog" class="btn btn-primary">عرض السجل</button>
                                                                        </div>
                                                                    </div>
                                                                    <div id="secretaryLogWrapper" style="display:none;margin-bottom:12px;">
                                                                        <div id="secretaryLog"></div>
                                                                    </div>

                                    <div style="  border: 10px solid var(--warning);
        color: var(--primary);" id="attendancesContainer">
                                            <div class="loading">
                                                    <div class="loading-spinner"></div>
                                                    <p>جاري تحميل بيانات الحضور...</p>
                                            </div>
                                    </div>
                </div>
            </div>
    </div>
        
    <!-- Status Message -->
    <div id="status"></div>

    <!-- Student Modal -->
    <div id="studentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="studentModalTitle">إضافة طالب جديد</h2>
                <button class="close" onclick="closeModal('studentModal')">&times;</button>
            </div>
            <form id="studentForm">
                <div class="modal-body">
                    <input type="hidden" id="studentId">
                    <div class="form-group">
                        <label for="fullName">الاسم الكامل</label>
                        <input type="text" id="fullName" required>
                    </div>
                    <!-- داخل studentModal، ضمن قسم تعديل الطالب -->
    <div class="form-group">
    <label for="editStudentAvatar">تغيير الصورة الشخصية:</label>
    <input type="file" id="editStudentAvatar" name="editStudentAvatar" accept="image/*">
    <img id="editAvatarPreview" src="" alt="معاينة الصورة" style="display:none; max-width: 100px; max-height: 100px; margin-top: 10px; border-radius: 50%;">
    </div>
                    <div class="form-group">
                        <label for="email">البريد الإلكتروني</label>
                        <input type="email" id="email">
                    </div>
                    <div class="form-group">
                        <label for="phone">رقم الهاتف</label>
                        <input type="text" id="phone">
                    </div>
                    <!-- بداية إضافة حقل رقم ولي الأمر -->
                    <div class="form-group">
                        <label for="parentPhone">رقم هاتف ولي الأمر</label>
                        <input type="text" id="parentPhone">
                    </div>
                    <!-- نهاية إضافة حقل رقم ولي الأمر -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('studentModal')">إلغاء</button>
                    <button type="submit" class="btn btn-primary">حفظ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Course Modal -->
    <div id="courseModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="courseModalTitle">إضافة كورس جديد</h2>
                    <button class="close" onclick="closeModal('courseModal')">&times;</button>
                </div>
                <form id="courseForm">
                    <div class="modal-body">
                        <input type="hidden" id="courseId">
                        <div class="form-group">
                            <label for="courseName">اسم الكورس</label>
                            <input type="text" id="courseName" required>
                        </div>
                        <div class="form-group">
                            <label for="courseDescription">الوصف</label>
                            <textarea id="courseDescription" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="coursePrice">السعر (ج.م)</label>
                            <input type="number" id="coursePrice" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="teacher">المعلم المسؤول</label>
                            <select id="teacher" required>
                                <option value="">اختر معلماً</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="startDate">تاريخ البداية</label>
                            <input type="date" id="startDate">
                        </div>
                        <div class="form-group">
                            <label for="endDate">تاريخ النهاية</label>
                            <input type="date" id="endDate">
                        </div>

                        <!-- قسم إضافة الوحدات -->
                        <div class="form-section">
                            <h3>الوحدات</h3>
                            <div id="modulesContainer">
                                <!-- سيتم إضافة الحقول الديناميكية هنا -->
                            </div>
                            <button type="button" class="btn btn-secondary" onclick="addModuleField()">إضافة وحدة</button>
                        </div>

                        <!-- قسم إضافة الدروس -->
                        <div class="form-section">
                            <h3>الدروس</h3>
                            <div id="lessonsContainer">
                                <!-- سيتم إضافة الحقول الديناميكية هنا -->
                            </div>
                            <button type="button" class="btn btn-secondary" onclick="addLessonField()">إضافة درس</button>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('courseModal')">إلغاء</button>
                        <button type="submit" class="btn btn-primary">حفظ</button>
                    </div>
                </form>
            </div>
    </div>

    <!-- Full Subscription Modal -->
    <div id="subscriptionModal" class="modal">
    <div class="modal-content">
    <div class="modal-header">
    <h2 id="subscriptionModalTitle">إضافة اشتراك شامل</h2>
    <button class="close" onclick="closeModal('subscriptionModal')">&times;</button>
    </div>
    <form id="subscriptionForm">
    <div class="modal-body">
        
        <!-- بيانات الطالب -->
        <h3>بيانات الطالب</h3>
        <div class="form-group">
        <label for="studentName">اسم الطالب</label>
        <input type="text" id="studentName" placeholder="اكتب اسم الطالب" required>
        </div>
        <!-- داخل Modal، ضمن قسم بيانات الطالب -->
    <div class="form-group">
    <label for="studentAvatar">الصورة الشخصية:</label>
    <input type="file" id="studentAvatar" name="studentAvatar" accept="image/*">
    <!-- معاينة الصورة -->
    <img id="avatarPreview" src="" alt="معاينة الصورة" style="display:none; max-width: 100px; max-height: 100px; margin-top: 10px; border-radius: 50%;">
    </div>
        <div class="form-group">
        <label for="studentPhone">رقم الهاتف</label>
        <input type="text" id="studentPhone" placeholder="اكتب رقم الهاتف">
        </div>
        <div class="form-group">
    <label for="studentParentPhone">رقم ولي الأمر</label>
    <input type="text" id="studentParentPhone" name="studentParentPhone" class="form-control" placeholder="أدخل رقم ولي الأمر">
    </div>

        <div class="form-group">
        <label for="studentEmail">البريد الإلكتروني</label>
        <input type="email" id="studentEmail" placeholder="اكتب البريد الإلكتروني">
        </div>

        <hr>

        <!-- تفاصيل الكورس -->
        <h3>تفاصيل الكورس</h3>
    <div class="form-group">
    <label for="courseSelect">الكورس</label>
    <select id="courseSelect" required onchange="updateCoursePrice()">
    <option value="">اختر كورساً</option>
    </select>
    </div>


    <div class="form-group">
    <label for="paymentAmount">المبلغ المدفوع</label>
    <input type="number" id="paymentAmount" placeholder="0" oninput="calculateRemaining()">
    </div>

    <div class="form-group">
    <label>المتبقي</label>
    <input type="text" id="remainingAmount" readonly>
    </div>


    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeModal('subscriptionModal')">إلغاء</button>
        <button type="submit" class="btn btn-primary">حفظ الاشتراك</button>
    </div>
    </form>
    </div>
    </div>

    <!-- Payment Modal -->
    <div id="paymentModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="paymentModalTitle">إضافة دفعة جديدة</h2>
                    <button class="close" onclick="closeModal('paymentModal')">&times;</button>
                </div>
                <form id="paymentForm">
                    <div class="modal-body">
                        <input type="hidden" id="paymentId">
                        <div class="form-group">
                            <label for="paymentStudent">الطالب</label>
                            <select id="paymentStudent" required>
                                <option value="">اختر طالباً</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="paymentCourse">الكورس</label>
                            <select id="paymentCourse" required>
                                <option value="">اختر كورساً</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="amount">المبلغ المدفوع (ج.م)</label>
                            <input type="number" id="amount" step="0.01" required>
                        </div>
                            <div class="form-group">
                            <label for="remainingAmount">المبلغ المتبقي (ج.م)</label>
                            <input type="number" id="remainingAmount" step="0.01" readonly style="background-color: #f0f0f0;">
                        </div>
                        <div class="form-group">
                            <label for="totalAmount">إجمالي الكورس (ج.م)</label>
                            <input type="number" id="totalAmount" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="paymentMethod">طريقة الدفع</label>
                            <select id="paymentMethod" required>
                                <option value="cash">نقداً</option>
                                <option value="card">بطاقة</option>
                                <option value="transfer">تحويل</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="paymentDate">تاريخ الدفع</label>
                            <input type="date" id="paymentDate" required>
                        </div>
                        <div class="form-group">
                            <label for="paymentStatus">الحالة</label>
                            <select id="paymentStatus" required>
                                <option value="paid">مدفوع</option>
                                <option value="pending">معلق</option>
                                <option value="cancelled">ملغى</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="paymentNotes">ملاحظات</label>
                            <textarea id="paymentNotes" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('paymentModal')">إلغاء</button>
                        <button type="submit" class="btn btn-primary">حفظ</button>
                    </div>
                </form>
            </div>
    </div>

    <!-- Attendance Modal -->
    <div id="attendanceModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="attendanceModalTitle">إضافة حضور جديد</h2>
                    <button class="close" onclick="closeModal('attendanceModal')">&times;</button>
                </div>
                <form id="attendanceForm">
                    <div class="modal-body">
                        <input type="hidden" id="attendanceId">
                        <div class="form-group">
                            <label for="attendanceStudent">الطالب</label>
                            <select id="attendanceStudent" required>
                                <option value="">اختر طالباً</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="attendanceCourse">الكورس</label>
                            <select id="attendanceCourse" required>
                                <option value="">اختر كورساً</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="attendanceDate">التاريخ</label>
                            <input type="date" id="attendanceDate" required>
                        </div>
                        <div class="form-group">
                            <label for="attendanceStatus">الحالة</label>
                            <select id="attendanceStatus" required>
                                <option value="present">حاضر</option>
                                <option value="absent">غائب</option>
                                <option value="late">متأخر</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="attendanceNotes">ملاحظات</label>
                            <textarea id="attendanceNotes" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('attendanceModal')">إلغاء</button>
                        <button type="submit" class="btn btn-primary">حفظ</button>
                    </div>
                </form>
            </div>
    </div>

        <!-- Student Detail Modal -->
    <div id="studentDetailModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>تفاصيل الطالب</h2>
                    <button class="close" onclick="closeModal('studentDetailModal')">&times;</button>
                </div>
                <div class="modal-body" id="studentDetailContent">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>جاري تحميل تفاصيل الطالب...</p>
                    </div>
                </div>
            </div>
    </div>

    <!-- Student QR Modal -->
    <div id="studentQrModal" class="modal">
    <div class="modal-content" style="text-align:center;">
        <div class="modal-header">
        <h2 id="qrModalTitle">كود QR للطالب</h2>
        <button class="close" onclick="closeModal('studentQrModal')">&times;</button>
        </div>
        <div class="modal-body">
        <p id="qrStudentName" style="font-weight:bold;"></p>
        <div id="qrCanvas" style="margin:20px auto;"></div>
        <button class="btn btn-primary" onclick="window.print()">
            <i class="fas fa-print"></i> طباعة
        </button>
        </div>
    </div>
    </div>


    <!-- Payment Receipt Modal -->
    <div id="paymentReceiptModal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header">
                    <h2>إيصال دفع</h2>
                    <button class="close" onclick="closeModal('paymentReceiptModal')">&times;</button>
                </div>
                <div class="modal-body" id="paymentReceiptContent">
                    <!-- سيتم ملء المحتوى ديناميكياً -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('paymentReceiptModal')">إغلاق</button>
                    <button class="btn btn-primary" onclick="printPaymentReceipt()">طباعة الإيصال</button>
                </div>
            </div>
    </div>

        <!-- Attendance Receipt Modal -->
    <div id="attendanceReceiptModal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header">
                    <h2>إيصال حضور</h2>
                    <button class="close" onclick="closeModal('attendanceReceiptModal')">&times;</button>
                </div>
                <div class="modal-body" id="attendanceReceiptContent">
                    <!-- سيتم ملء المحتوى ديناميكياً -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('attendanceReceiptModal')">إغلاق</button>
                    <button class="btn btn-primary" onclick="printAttendanceReceipt()">طباعة الإيصال</button>
                </div>
            </div>
    </div>


    <!-- نموذج إدارة الاختبار -->
    <div id="examModal" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); justify-content: center; align-items: center; direction: rtl;">
    <div class="modal-content" style="
        background: white;
        width: 90%;
        max-width: 500px;
        border-radius: 12px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        overflow: hidden;
        animation: modalFadeIn 0.3s ease-out;
    ">
        <!-- رأس النموذج -->
        <div style="background: #007bff; color: white; padding: 15px 20px; text-align: center; font-size: 1.2em; font-weight: 600;">
        <span id="examModalTitle">إضافة اختبار جديد</span>
        </div>

        <!-- زر الإغلاق -->
        <span onclick="closeModal('examModal')" style="
        position: absolute;
        top: 15px;
        left: 20px;
        font-size: 24px;
        color: white;
        cursor: pointer;
        font-weight: bold;
        ">&times;</span>

        <!-- محتوى النموذج -->
        <form id="examForm" onsubmit="event.preventDefault(); saveExam();" style="padding: 25px;">
        <input type="hidden" id="examId">

        <!-- عنوان الاختبار -->
        <div style="margin-bottom: 15px;">
            <label for="examTitle" style="display: block; margin-bottom: 6px; font-weight: 600; color: #333;">عنوان الاختبار *</label>
            <input type="text" id="examTitle" required style="
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            background: #f9f9f9;
            ">
        </div>

        <!-- الكورس -->
        <div style="margin-bottom: 15px;">
            <label for="examCourse" style="display: block; margin-bottom: 6px; font-weight: 600; color: #333;">اختر الكورس *</label>
            <select id="examCourse" required style="
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            background: #f9f9f9;
            ">
            <option value="">اختر كورساً</option>
            </select>
        </div>

        <!-- الوحدة -->
        <div style="margin-bottom: 15px;">
            <label for="examModule" style="display: block; margin-bottom: 6px; font-weight: 600; color: #333;">اختر الوحدة *</label>
            <select id="examModule" required style="
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            background: #f9f9f9;
            ">
            <option value="">اختر وحدة</option>
            </select>
        </div>

        <!-- الدرجة القصوى -->
        <div style="margin-bottom: 15px;">
            <label for="examMaxScore" style="display: block; margin-bottom: 6px; font-weight: 600; color: #333;">الدرجة القصوى *</label>
            <input type="number" id="examMaxScore" step="0.5" min="1" required style="
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            background: #f9f9f9;
            ">
        </div>


        <!-- أزرار الإجراءات -->
        <div style="text-align: left; margin-top: 10px;">
            <button type="button" onclick="closeModal('examModal')" style="
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
            ">إلغاء</button>
            <button type="submit" style="
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            ">حفظ</button>
        </div>
        </form>
    </div>
    </div>

    <!-- Modal for Editing Subscription -->
    <div id="editSubscriptionModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('editSubscriptionModal')">&times;</span>
        <h2 id="subscriptionModalTitle">تعديل بيانات الاشتراك</h2>
        <form id="editSubscriptionForm">
        <div class="modal-body">

    <!-- Hidden fields for IDs -->
    <input type="hidden" id="editSubscriptionId">
    <input type="hidden" id="editStudentId">
    <input type="hidden" id="editCourseId">

    <!-- Student Info (Read-only) -->
    <div class="form-group">
    <label>الطالب</label>
    <p id="editStudentName" class="form-control-plaintext">-</p>
    </div>

    <!-- Course Info (Read-only) -->
    <div class="form-group">
    <label>الدورة</label>
    <p id="editCourseName" class="form-control-plaintext">-</p>
    </div>

            <!-- Subscription Date -->
            <div class="form-group">
            <label for="editSubscriptionDate">تاريخ الاشتراك</label>
            <input type="date" id="editSubscriptionDate" required>
            </div>

            <!-- Status -->
            <div class="form-group">
            <label for="editSubscriptionStatus">الحالة</label>
            <select id="editSubscriptionStatus" required>
                <option value="active">نشط</option>
                <option value="inactive">غير نشط</option>
            </select>
            </div>

            <!-- Notes -->
            <div class="form-group">
            <label for="editSubscriptionNotes">ملاحظات</label>
            <textarea id="editSubscriptionNotes" rows="3"></textarea>
            </div>

        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeModal('editSubscriptionModal')">إلغاء</button>
            <button type="submit" class="btn btn-primary">تحديث الاشتراك</button>
        </div>
        </form>
    </div>
    </div>
    <!-- أنميشن دخول النموذج -->

    </div>
    <!-- WhatsApp preview modal for parents report -->
    <div id="waPreviewModal" class="modal" style="display:none;">
    <div class="modal-content" style="max-width:720px;">
        <div class="modal-header">
        <h3>معاينة رسالة واتساب</h3>
        <button class="close-modal" id="waPreviewClose">×</button>
        </div>
        <div class="modal-body" style="padding:12px;">
        <p id="waPreviewPhone" style="font-weight:600;margin-bottom:8px;"></p>
        <textarea id="waPreviewMessage" readonly></textarea>
        </div>
        <div class="modal-footer">
        <button id="waCopyBtn" class="btn btn-secondary">نسخ النص</button>
        <button id="waOpenBtn" class="btn btn-primary">فتح واتساب</button>
        <button id="waCloseBtn" class="btn">إغلاق</button>
        </div>
    </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <!-- JS Files -->
    <script src="secretary-js/utils.js"></script>
    <script src="secretary-js/master.js"></script>
    <script src="secretary-js/cuorses.js"></script>
    <script src="secretary-js/students-tab.js"></script>
    <script src="secretary-js/teacher-exams-tab.js"></script>
    <script src="secretary-js/waModal.js"></script>
    <script src="secretary-js/autoRefresh.js"></script>
    <script src="secretary-js/tabRefresher.js"></script>
    <script src="secretary-js/dataManagement.js"></script>
    <script src="secretary-js/sidebarToggle.js"></script>
    <script src="secretary-js/tableResponsive.js"></script>
    <script src="secretary-js/secretaryLog.js"></script>


    </body>